DynamicBind：使用深度等变生成模型预测配体特异性蛋白质-配体复合物结构

摘要: 尽管在预测静态蛋白质结构方面取得了显著进展，但蛋白质的固有动力学，由配体调节，对于理解蛋白质功能和促进药物发现至关重要。传统的 docking 方法通常将蛋白质视为刚性体。在研究蛋白质-配体相互作用时，通常使用这些方法。虽然分子动力学模拟可以提出适当的蛋白质构象，但由于在生物学上相关的平衡态之间的转换很少见，这些模拟在计算上是昂贵的。在这项研究中，我们提出 DynamicBind，一种使用等变几何扩散网络构建平滑能量景观的深度学习方法，从而促进不同平衡态之间的高效转换。DynamicBind 可以从未结合的蛋白质结构中准确恢复配体特异性构象，无需 holo 结构或大量采样。值得注意的是，它在 docking 和虚拟筛选基准测试中表现出最先进的性能。我们的实验表明，DynamicBind 可以适应广泛的蛋白质构象变化，并在未见的蛋白质靶点中识别出隐蔽的口袋。因此，DynamicBind 表明它有潜力加速开发以前无法药化的目标的小分子，并扩大计算药物发现的视野。

在蛋白质结构预测领域，从序列数据中取得了显著进展。一些预测技术使用机器学习与分子动力学或蒙特卡罗方法, , ,相结合。这些方法生成了一组结构。AlphaFold在预测人类蛋白质组中几乎所有结构方面处于领先地位，然而，它通常只为每个蛋白质序列生成少数几个构象，尽管蛋白质本质上是动态的，并且通常采用多种构象来执行其功能, , , ,。蛋白质之间的相互转换对于其在所有生命领域中的生物学活动至关重要。药物分子的治疗效果源于其特异性地结合到目标蛋白质的某些构象，并通过改变这些蛋白质的构象景观来调节基本的生物学活动, , ,。在实践中，蛋白质和配体之间的相互作用通常通过计算机分子对接方法来研究。对接是基于结构的药物发现的关键组成部分 。然而，尽管蛋白质动力学的重要性得到广泛认可，但传统的对接方法通常将蛋白质视为刚性体，或者在某些情况下，只允许选择的侧链移动，以管理计算成本,。因此，AlphaFold预测的apo蛋白质结构作为对接的输入，将产生与配体结合的晶体结构不符的配体构象预测,。AlphaFold预测的结构通常不呈现最有利的侧链旋转构象以便于配体结合，因此相关的结合口袋将由于apo蛋白质采用与全长态明显不同的构象而变得无法访问。

在这里，我们提出DynamicBind，一种用于“动态对接”的几何深度生成模型。与传统的对接方法相比，DynamicBind能够高效地调整蛋白质构象，从其初始AlphaFold预测到全长态。我们的模型能够处理预测过程中广泛的大型构象变化，例如在激酶蛋白中著名的DFG-in到DFG-out转变，这一直是其他方法（如分子动力学（MD）模拟）,面临的挑战。我们通过学习一个通道的能量景观来实现这种效率，在这种景观中，生物学相关状态之间的转变最小地受到阻碍 。这得益于我们在训练过程中采用了一种类似于形态的变换来生成诱饵结构（更多信息请参见“DynamicBind架构”和“方法”）。我们的方法与Boltzmann生成器,有相似之处，因为它允许直接高效地从学习的模型中采样低能态。然而，与传统的Boltzmann生成器不同，传统的Boltzmann生成器通常局限于其训练的系统，DynamicBind是一种可泛化的模型，可以处理新的蛋白质和配体。

在即将到来的结果部分，我们将全面评估DynamicBind，展示其在辅助药物发现方面的潜力。我们的介绍分为六个部分：首先概述DynamicBind模型；然后将DynamicBind与当前的对接方法进行基准测试；然后强调该方法在配体特异性方式下采样大型蛋白质构象变化的能力；然后具体展示它可以处理的构象变化范围；通过案例研究展示其预测隐性口袋的能力；最后展示其在使用抗生素数据集的全蛋白质组虚拟筛选任务中的应用。这些研究共同突出了DynamicBind的潜力，为进一步理解和操纵蛋白质-配体相互作用景观奠定了基础 。

DynamicBind执行“动态对接”，这是一个预测蛋白质-配体复合物结构的过程，同时适应了大量的蛋白质构象变化。DynamicBind接受apo-like结构（在本研究中，AlphaFold预测的构象）以PDB格式和小分子配体以多种广泛可用的格式，例如简化的分子输入线条输入系统（SMILES）或结构数据文件（SDF）格式。 在推理过程中，模型随机地将配体放在蛋白质周围，其种子构象是使用RDKit生成的 。然后，在20次迭代过程中（更多细节请参见“模型架构”），使用逐渐减小的时间步长，模型逐渐平移和旋转配体，同时调整其内部扭转角度。在最初的五个步骤中，只改变配体构象，模型然后同时平移和旋转蛋白质残基，同时修改侧链χ角度，在剩余的步骤中。

如Fig. [1] a所示，在每一步中，蛋白质和配体的特征和坐标被输入到SE（3）-等变的相互作用模块中。然后，蛋白质和读出模块生成当前状态的预测平移、旋转和二面角更新。有关模型的更多细节，请参见“蛋白质构象转换”。与传统的基于扩散的模型训练协议不同，传统协议通过用高斯噪声扰动本地状态来生成诱饵结构，我们的方法采用类似于形态的变换来产生蛋白质诱饵结构。在此过程中，本地构象逐渐转变为AlphaFold预测的构象。蛋白质的结构受到多种约束，残基通过肽键连接，键长由化学原理支配。当使用高斯噪声生成诱饵结构时，模型主要学习如何恢复到最化学稳定的构象，通常是添加噪声之前的构象。在当前任务中，配体结合的全长态构象是未知的，最容易获得的蛋白质结构是AlphaFold预测的结构，它通常与全长态构象有显著差异。鉴于AlphaFold预测的结构通常已经满足了大多数化学约束，因此很难预测仅使用高斯噪声生成的诱饵结构的模型如何准确预测生物相关性的长时间尺度转变，这是我们的主要关注点。相比之下，我们的形态变换生成的诱饵结构通常满足基本的化学约束，使我们的模型能够专注于学习生物物理相关的状态变化事件。在无偏见的分子动力学模拟中，诸如DFG“in”和“out”转变之间的转变由于全原子力场中的现实但崎岖的能量景观而不频繁, , , ,。相比之下，我们的方法具有显著更通道化的能量景观，有效地降低了生物学上有意义的状态之间的自由能障碍。因此，与其他Boltzmann生成器方法一样,，我们的方法在采样与配体结合相关的替代状态方面表现出显著增强的效率。已包含一个示意图来阐明这些差异（Fig. [1] b）。

为了评估我们的方法，我们首先使用PDBbind数据集，并按照之前的工作，使用时间顺序的训练、验证和测试集来训练模型。由于PDBbind测试集包含大约300个2019年的结构，其中包括许多非小分子配体（53个案例是多肽），我们扩大了评估范围，使用了一个经过策划的主要药物目标（MDT）测试集。MDT集包括599个结构，这些结构是在2020年或之后存入的，包括具有药物样配体和来自四个主要蛋白质家族的蛋白质：激酶、GPCR、核受体和离子通道（请参阅“数据集构建”以获取更多详细信息）。这些蛋白质家族代表了大约70％的FDA批准的小分子药物的目标, ,。

与其使用全长结构作为输入，我们采用了一个更具挑战性和现实性的场景，在测试中，我们假设全长蛋白质构象不可用，只使用AlphaFold预测的蛋白质构象作为输入。全长构象表现出强烈的形状和电荷互补性与共晶化配体，这已经在一定程度上简化了配体姿势预测 。相比之下，apo构象或AlphaFold预测的构象可能与通过对齐晶体结构获得的移植配体发生冲突 。

如Fig. [2] a和b所示，DynamicBind预测了更多的配体RMSD低于各种阈值的案例，超过了其他基线。在特定情况下，它实现了配体RMSD低于2Å（5Å）的比例，分别为PDBbind测试集的33％（65％）和MDT测试集的39％（68％）。

仅评估配体RMSD可能会偏向基于深度学习的模型（DiffDock、TankBind和DynamicBind），因为它们具有更高的冲突容忍度，而可能会不利于严格执行范德华力场的力场基方法（GNINA、GLIDE、VINA）。显著的冲突可能会阻碍结构基药物设计中的相互作用分析，掩盖了至关重要的分子相互作用，并使分子改进的设计复杂化。因此，我们使用配体RMSD和冲突评分（如Hekkelman等人所定义）来评估成功率。Fig. [2] c显示了使用严格标准（配体RMSD＜2Å，冲突评分＜0.35）和更宽松标准（配体RMSD＜5Å，冲突评分＜0.5）的成功率。DynamicBind（0.33）的成功率是最好的基线DiffDock（0.19）在更严格条件下的1.7倍。此外，DynamicBind已证明能够减少相对于初始AlphaFold结构的口袋RMSD，即使在原始口袋RMSD很大的情况下（Fig. [2] d）。这一观察强调了该方法能够管理显著的构象变化，在其他方法可能难以应对的情况下恢复全长结构。鉴于我们的模型能够生成多样化的构象，我们开发了接触-LDDT（cLDDT）评分模块，这个概念受到了AlphaFold的LDDT评分的启发。该模块的目的是从预测的输出中选择最合适的复合结构。如Fig. [2] e所示，我们预测的cLDDT与实际配体RMSD相关性良好，表明其在选择高质量复合结构方面的有效性。配体RMSD低于2Å的auROC评分为0.764。虽然我们的cLDDT评分函数是有效的，但仍有改进的潜力。完美的选择可以将我们的成功率从0.33提高到0.5，如Fig. [2] f所示。即使在没有理想选择模型的情况下，我们的方法也明显优于DiffDock和最好的力场基方法GLIDE。由于Glide的过滤方案消除了不切实际的构象，Glide的最佳性能使用平线表示。该线反映了Glide最有效样本确定的成功率。DynamicBind的卓越性能源于其能够进行显著的蛋白质构象变化，从而实现蛋白质和配体之间更好的拟合 。

为了评估模型对新蛋白质和配体的泛化能力，我们分析了按最大配体和蛋白质序列相似度划分的结果（补充Fig. [3] 和 [4] ）。该分析表明，DynamicBind在新配体方面表现良好，超过了其他方法，但在新蛋白质方面效果较差，在那里它被具有预定义真实结合口袋的经典对接方法超越。其他深度学习方法也表现出类似的下降趋势，表明需要更大的训练集和改进的归纳偏差。此外，考虑到识别新蛋白质上的结合位点是一个活跃的研究领域，包括我们在内的深度学习方法在盲目全局对接中遇到的挑战可能在不同方法中都存在。总体而言，DynamicBind在新配体方面的熟练程度在药物发现中具有重要意义，突出了其在识别为创建有效、特异性药物所必需的蛋白质构象变化方面的潜力。

传统的对接协议通常将蛋白质构象采样作为对接过程的一个独立步骤,。在许多情况下，然而，两个不同的配体可能适应互相排斥的蛋白质构象。例如，c-Met激酶可以采用两种不同的构象，分别对应于活性和非活性状态，通常被称为Asp–Phe–Gly（DFG）-in和DFG-out构象（Fig. [3] b, d）。DFG基序可以翻转，随后阻塞或打开蛋白质的不同区域。在以前的对接模型中，蛋白质必须预设为正确的构象才能有机会识别配体的适当结合姿势 。相比之下，DynamicBind利用AlphaFold预测的蛋白质构象（Fig. [3] a），可以动态调整蛋白质构象以找到适应配体的最佳构象。作为一个代表性的例子，对于PDB 6UBW，预测的配体RMSD为0.49 Å，口袋RMSD为1.97 Å，而AlphaFold结构的口袋RMSD为9.44 Å。对于PDB 7V3S，预测的配体RMSD为0.51 Å，口袋RMSD为1.19 Å（AlphaFold 6.02 Å）。这两个配体都没有在训练集中出现过（Fig. [3] c, e）。在我们的定量分析中，测试集中的七种蛋白质（用其UniProt ID表示），包含了79个PDB结构，发现它们都采用了DFG-in和DFG-out构象，如Kinase–Ligand Interaction Fingerprints and Structures（KLIFS）网络服务器所注释的 。Fig. [3] f和g展示了这些蛋白质（用其UniProt ID表示），从相同的初始结构开始，逐渐向DFG-in构象移动，当与类型I抑制剂结合时，并且向DFG-out构象移动，当与类型II抑制剂相互作用时。进一步，Fig. [3] h显示，大多数预测的蛋白质结构的口袋RMSD都比初始AlphaFold结构低。这些结果表明，DynamicBind能够捕获配体特异性的构象变化。这一特性对于防止忽略可能与初始提供的蛋白质结构不同的构象结合良好的潜在“命中”化合物至关重要。

DFG-in/out构象已经被广泛研究，一些挑战可以通过采用集合对接来部分解决，其中蛋白质采用两种构象进行对接,。然而，集合对接会增加计算成本，并可能不适合于较少特征化的构象。在本节中，我们对六种不同的构象变化进行了全面分析，每种变化都以我们PDBbind测试集中的一个案例为例。在Fig. [4] 中，晶体结构以粉色表示，AlphaFold结构以白色表示，我们的预测以绿色表示。native配体以青色表示，我们预测的配体以橙色表示。Δ口袋RMSD衡量预测的蛋白质结构和AlphaFold结构之间的口袋RMSD差异，基于与晶体结构的比较。负的Δ口袋RMSD表示预测的结构与晶体结构更为接近。Δ碰撞衡量预测的蛋白质-配体对和AlphaFold结构与移植配体之间的碰撞得分差异 。负的Δ碰撞表示预测的复合物中碰撞得分更低。在Fig. [4] a中，native配体与叠加的AlphaFold结构中的一个侧链发生碰撞；在我们的预测中，这个侧链向native构象移动，解除了碰撞。在Fig. [4] b中，口袋的一部分被AlphaFold结构中的一个酪氨酸阻塞；在我们的预测和native结构中，它变得可访问。在Fig. [4] c中，一个灵活的环与配体相交，在我们的预测中它远离了配体，与native结构一致。在Fig. [4] d中，近配体结合位点的α螺旋转变为环。在Fig. [4] e中，热休克蛋白Hsp90α观察到显著的二级结构运动，从闭合状态转变为开放状态。在Fig. [4] f中，AKT1激酶的两个结构域融合，形成了一个以前不存在的口袋。总的来说，当前模型可以预测与配体结合相关的多种构象变化，当AlphaFold预测的构象中口袋空间不足或未形成时。

蛋白质的动态性质通常会产生隐蔽的口袋。这些隐蔽的口袋，在蛋白质动力学过程中出现，可以揭示静态结构中未发现的可药性位点，从而使以前的“不可药化”蛋白质成为潜在的药物目标。我们使用组蛋白甲基转移酶SETD2作为一个案例研究，展示了DynamicBind在揭示这些隐蔽口袋的作用。SETD2对于多发性骨髓瘤（MM）和弥漫性大B细胞淋巴瘤（DLBCL）的治疗至关重要，具有一个隐蔽的口袋，被一种高度选择性的化合物EZM0414靶向，目前正在进行I期临床试验。如Fig. [5] a和b所示，所有训练集中的SETD2同源蛋白，定义为蛋白质Smith–Waterman相似度大于0.4，都与S-腺苷甲硫氨酸（SAM）或Sinefungin类似物共晶化，如线所示。Sinefungin及其类似物通过占据SAM位点广泛抑制甲基转移酶，使得SETD2的选择性抑制变得具有挑战性。在2019年之前，SETD2或其同源蛋白的结构中，没有一个化合物与EZM0414结合的位点共晶化（用青色棒表示）。因此，我们的模型没有在任何结构中训练过与这个新识别的位点结合的化合物。在Fig. [5] c中，AlphaFold结构及其表面以白色表示。隐蔽位点似乎被阻塞，导致与移植的EZM0414发生显著碰撞。Fig. [5] d确认EZM0414是一个未见的配体，即使是训练集中最相似的Tanimoto配体也与EZM0414有显著差异。Fig. [5] e显示了我们的模型预测的蛋白质-配体复合物结构，使用SETD2的AlphaFold预测结构和EZM0414的SMILES表示作为输入。Fig. [5] f叠加了我们的预测与SETD2-EZM0414复合物的晶体结构（PDB 7TY2）。结果配体RMSD为1.4 Å，口袋RMSD为2.16 Å。此外，我们在补充信息中包含了几个来自Cryptosite数据集的案例，这些案例与我们的训练集具有低序列相似度,。

在基于靶点的药物发现中，潜在药物候选物的筛选和反向筛选（即识别特定化合物的蛋白质靶点）都是至关重要的。这些过程需要在蛋白质和化合物水平上准确预测结合亲和力。因此，我们在模型中添加了一个亲和力预测模块，使用PDBbind数据集中的实验测量结合亲和力数据进行训练。为了评估DynamicBind在真实虚拟筛选场景中的性能，我们使用了最近发布的抗生素实验基准 。该数据集包括来自大肠杆菌必需蛋白质组的12种蛋白质与218种活性抗生素化合物的2616对蛋白质-化合物对，均未在我们的训练阶段遇到。Fig. [6] a显示，DynamicBind在平均面积下受试者操作特征（auROC）曲线方面优于VINA和DOCK6.9等常见对接方法以及最好的机器学习重评分方法，达到0.68的平均auROC值。基线数值直接来自基准论文 。这种性能改进是由于DynamicBind的动态对接能力，它将AlphaFold结构细化为更为native-like的状态，从而实现更精确的结合亲和力估计。如Fig. [6] b所示，murD蛋白质的预测结构在配体周围更为紧密，形成了与初始AlphaFold结构中不可能的更多相互作用。这种评估与我们在PDBbind测试集上的结合亲和力预测基准一致（补充表 [1] ），其中DynamicBind始终优于传统对接方法和基于深度学习的刚性对接方法。这些结果表明，DynamicBind具有结合亲和力预测能力，对于蛋白质组水平的虚拟筛选应用具有显著的潜力。

DynamicBind将两个传统上分开的步骤，蛋白质构象生成和配体姿势预测，统一到一个框架中。作为一个端到端的深度学习方法，它比传统的MD模拟快了几个数量级，在采样广泛的蛋白质构象变化方面。与传统对接方法不同，DynamicBind不需要预定义的结合口袋，因此它能够执行全局对接，这一特性在结合口袋尚未被识别时变得至关重要。这些优势使得DynamicBind能够进行针对隐蔽口袋的化合物的虚拟筛选。这些化合物可能只与目标蛋白质特异性结合，从而潜在地最小化副作用。此外，DynamicBind可以预测新的药物候选物是否可能与意外的蛋白质靶点结合，或者在通过表型筛选发现活性化合物时帮助识别结合靶点。

DynamicBind在我们的基准中表现出最先进的性能，但仍然存在改进的机会，特别是在增强其对训练集中序列同源性低的蛋白质的泛化能力方面,。作为一个数据驱动的模型，它从Cryo-EM方法的快速进步中受益, ,。这些技术进步将扩大我们训练数据的多样性和全面性，以更快的速度提供更多蛋白质-配体复合物的构象。还有潜在的改进DynamicBind的方法，即利用大量非结构结合亲和力数据，这些数据目前比晶化结构更丰富。通过采用类似于AlphaFold的自我蒸馏方法，我们可以通过整合以前只有亲和力数据的蛋白质-配体对的复合物结构的高置信度预测来增强我们的训练集 。

总之，DynamicBind 提出了一个“动态 docking”方法来研究蛋白质-配体相互作用，这与传统的 docking 方法不同，传统方法将蛋白质视为静态的，而分子动力学（MD）模拟则计算量大。其大规模蛋白质动力学能力对药物分子发现，尤其是针对隐蔽口袋的药物分子，具有特别重要的意义。另外，DynamicBind 生成的配体特异性蛋白质构象可能提供有价值的见解，了解配体对蛋白质的影响，可能阐明结构-功能关系，并增强我们对其机制的理解。

我们的模型是一个 E(3)-等变的、基于扩散的图神经网络，使用粗粒化表示。

一个 E(3)-等变模型根据输入x 在 3D 空间中的转换和奇偶操作来转换输出y 。研究表明，等变模型可以用 1000 倍少的数据训练，同时在 bulk 水的结构上取得更好的结果 。尽管电子 cryo 显微镜和晶体学取得了重大进展，但现有的蛋白质-配体复合物数据库仍然相对有限，只有几万个。因此，需要一个高效的模型，能够辨别最相关的信息，避免不必要的信息，这些信息在重新定位或旋转整个结构时不成立。传统方法满足 SO(3) 对称性，仅使用或预测不变量，例如接触图。然而，接触图或距离图并不总是与物理上可行的配置相关。例如，一个残基可能被预测为与两个遥远的原子接触。另外，接触图可能忽略手性，这是药物发现中的一个重要方面 。

作为一个基于扩散的模型，DynamicBind 通过一个过程训练，该过程逐渐以各种程度扭曲本地构象，使模型能够学习如何恢复正确的构象。扭曲原始配置通常涉及将转位高斯噪声添加到原子上。有化学键约束和范德华力强制排斥体积效应，恢复此类扭曲是直接的，当扭曲相对较小时。然而，我们观察到，仅仅添加高斯噪声是不足以训练一个模型，该模型可以预测从一个生物学上有意义的配置到另一个配置的转换。为了解决这个问题，我们引入了一个类似于形态的变换，插值于晶体蛋白质结构和 AlphaFold 预测的结构之间，从而减少了 meta-stable 配置（如 AlphaFold 预测的构象和配体结合的全构象）之间的转换障碍。与其他生成模型不同，后者训练一个评分函数s θ x , t = ≈ ∇ log p t(x),我们的扩散架构旨在直接将扭曲的结构映射回原始构象，类似于一致性模型,。模型的输出表示为f θ xt , t = − ϕ xt , t ,其中ϕ xt , t 表示添加到本地构象的类似于形态的变换。

传统方法使用全原子表示，显式建模每个原子的坐标。然而，原子由于通过化学键连接而不独立移动，局部几何形状受到高度约束——例如，苯环通常是平面的。为了减少这些非物理配置的自由度，我们采用了粗粒化表示，用于蛋白质和配体。在我们的模型中，每个蛋白质残基由一个节点表示，具有两个向量——坐标和方向，以及侧链二面角。更多细节请参见“特征化”。对于配体，每个重原子由一个节点表示，这些节点以外在-内在的方式转换，其中旋转角的变化转换为笛卡尔坐标的变化 。更多细节请参见“配体构象转换”。值得注意的是，尽管这是一个粗粒化表示，但所有非氢原子的坐标仍然可以一一映射。

我们的模型的输入是蛋白质和配体的当前构象。输出包括预测的更新到标量扭转角度和每个配体的两个平移-旋转向量，以及预测的更新到侧链二面角和每个蛋白质残基的两个平移-旋转向量。进一步的细节可以在“蛋白质构象转换”中找到。在此之外，模型产生两个标量输出：一个用于估计本地构象的程度，如通过联系-LDDT（contact-LDDT）评估的，并且另一个用于预测蛋白质和配体之间的结合亲和力 。

在我们的模型中，配体是属性图G l =(Vl , El)，其中每个节点v i l ∈ V l 代表一个重原子，芳香、单、双或三键作为边。配体图的节点特征包括原子序数、手性、度和正式电荷。此外，除了键类型外，边长嵌入也用作标量边特征。

蛋白质图表示为G p =(Vp , Ep)，其中每个节点v i p ∈ V p 对应于Cα位置的残基。蛋白质图中的节点特征包括氨基酸类型、语言模型嵌入来自esm 、以及侧链二面角，这些被表示为（7×2）-维零填充标量特征（五个可旋转的chi角度[chi1, chi2,..., chi5]和两个对称的chi角度[altchi1, altchi2]对于每个氨基酸，这些角度被转换为正弦和余弦值）。为了确保给定结构的侧链角度的唯一性，我们一致地将其处理为[max( chi1,altchi1 ), min( chi1,altchi1 ), max( chi2,altchi2 ), min( chi2,altchi2 )，chi3, chi4, chi5]。此外，主链方向被表示为两个单位向量特征，它们是xN − xCαxN−xCα 和xC − xCαxC−xCα 。对于边，长度嵌入被用作标量特征。我们的氨基酸特征化使模型能够推断所有重原子的位置。

DynamicBind是一个图神经网络，它使用了等变和不变特征。它使用张量积的不可约表示（irreps）来传播信息，如e3nn库中定义的那样 。















为了克服训练和推理之间的分布偏移，我们用匹配真实位点的构象x 0 l 替换训练目标。在时间t ，输入的配体构象是随机扰动的构象： 14 x t l =(Δ T0l ∘ ⋯ Δ Tkl) (Δ Rl  ( x0l−x ¯ 0l )+x ¯ 0l + Δ trl) 其中Δ tr l = N 0,σtrl, N 0,σtrl, N 0,σtrl Δ R l =旋转矩阵采样自p(ω)ω ̂ Δ T k l = N 0 , σtorl p(ω)= 1 − c o s(  ω  )π ∑ l = 0 ∞(2 l + 1)exp − l(  l+1  )( σrotl ) 2 sin(( l+1/2 ) ω  )sin(  ω/2  )，其中x  ¯0 l 是x 0 l , p(ω)的几何中心，ω ̂ 是通过随机采样生成的单位向量。

网络使用八个损失函数进行训练。总损失函数可以定义为 15L =13Ltrl+13Lrotl+13LTl+13Ltrp+13Lrotp+13LTp+ 0.01LA+ 0.99LD，其中L tr l , L rot l , L T l 分别是配体的平移、旋转和扭转损失函数。L tr p , L rot p 和L T p 分别是蛋白质残基的平移、旋转和扭转损失函数。L A 是结合亲和力损失函数，L D 是接触-LDDT损失函数。计算真实cLDDT的距离差为d = ∣ d(x0l , xholo)− d(xtl , xtp)∣  （更多关于cLDDT评分计算的细节可以在“评估指标”中找到）。

由于旋转向量u 与另一个向量v 表示相同的旋转，如果u 和v 具有相反的方向且 ∥u ∥ + ∥v ∥ = 2π 。因此，我们在计算旋转损失函数时取正向和反向的最小值。扭转角度损失函数使用预测值与添加的扭转角度噪声之间的角度差的余弦计算。完整的训练过程可以在补充算法 [1] 中找到。

在推理过程中，我们使用RDKit生成的配体构象和AlphaFold预测的蛋白质结构作为初始复合物构象。复合物结构使用20步更新。在每一步中，我们向去噪的配体构象添加一个小的随机噪声，以防止最终构象陷入局部最小值。对于每对配体和蛋白质，我们进行40次采样，并根据预测的cLDDT值对结合构象进行排序。我们还注意到，预测的结合亲和力加权平均值是实验测量亲和力的更准确的估计值（补充表 [1] ）。预测的cLDDT值用作权重。完整的推理过程可以在补充算法 [2] 中找到。

DynamicBind有6367万个参数，训练了5天，使用八个Nvidia A100 80GB GPU。

为了评估预测的复合结构中蛋白质和配体之间的相互作用，我们确定了分子间原生接触形成的程度。我们采用了一种类似于局部距离差异测试（LDDT）评分的定义，该评分以前曾用于量化预测蛋白质结构的原生性 。接触-LDDT（cLDDT）评分是通过考虑所有配体原子和蛋白质原子之间的距离（小于15 Å）来计算的。距离差异是通过比较真实值和预测的复合结构来确定的，同时考虑了对称性。最终的cLDDT评分是从四个容忍阈值（0.5、1、2和4 Å）中保留的距离的平均分数中得出的。

为了评估预测的蛋白质结构与原生蛋白质结构在结合口袋周围的偏差，我们计算了结合口袋的根均方偏差（pocket RMSD）。这是在参考配体原子5 Å范围内的蛋白质原子上进行的。最初，预测的蛋白质结构与晶体蛋白质结构对齐。然后，预测的口袋原子和晶体口袋原子之间的RMSD被确定。

与AlphaFill类似，碰撞评分是配体原子和蛋白质原子之间所有距离（小于4 Å）上的范德华重叠的根均方值。它的计算公式如下： 16 碰撞评分  =∑  i  =  0  N范德华重叠i  2N其中N 是考虑的距离数 。

我们的训练和测试数据集是基于PDBbind2020数据库构建的，该数据库包括19,443个蛋白质-配体复合物的晶体结构，每个结构都配有实验测量的结合亲和力。我们采用了与以前工作相同的时间分割，使用2019年之前存储的结构进行训练和验证，而2019年存储的结构则保留用于测试。每个蛋白质都与相应的AlphaFold预测结构对齐。对齐的AlphaFold结构和晶体结构用于通过形态学插值生成蛋白质部分的训练样本。主要药物目标（MDT）测试集是使用以下标准构建的：2020年或以后存储的PDB；属于四个主要药物目标群的蛋白质-激酶、GPCR、核受体和离子通道；AlphaFold预测的蛋白质结构的口袋RMSD大于2 Å（或口袋LDDT低于0.8）与晶体结构；配体是分子量在200-650道尔顿之间的药物样小分子；每个研究最多包含10个PDB。这些标准确保测试集具有挑战性，初始输入蛋白质与原生构象不同，并且具有代表性，涵盖了广泛的蛋白质目标。此外，它防止少数蛋白质主导整个测试集，因为某些研究存储了比其他研究更多的PDB，相同蛋白质与略微不同的配体共晶的结构, ,。

我们对PDBbind测试集（303个配体-受体对）和主要药物目标（MDT）测试集（599个配体-受体对）使用了不同的 docking 方法。 docking 配体从共晶结构中提取，而 docking 受体结构由AlphaFold预测。我们使用spyrmsd包中的symmrmsd函数进行所有RMSD计算 。

在 AutoDock Vina 中，配体从 SDF 格式转换为 PDBQT 格式，使用 Meeko 2.0.0。蛋白质准备使用 ADFR Suite 1.0 中的“prepare_receptor”命令进行。对接盒使用自动盒围绕本地配体，六个面默认缓冲区为 4 Å。盒中心是本地配体的质心。由于硼原子不是 AutoDock 的有效原子类型，因此含有该原子的配体不能对接。因此，只有 301 个配体-受体对在 PDBbind 数据集和 597 个配体-受体对在 MDT 数据集中具有 VINA rigid docking 的对接输出 。

与 VINA rigid docking 相比，VINA flexible docking 中有一个额外的灵活受体准备步骤。该步骤由一个名为“prepare_flexreceptor.py”的 python 脚本执行，该脚本可在https://github.com/ccsb-scripps/AutoDock-Vina/tree/develop/example/autodock_scripts 中找到。通过此步骤，蛋白质 PDBQT 格式文件被分为两个 PDBQT 格式文件，一个用于刚性部分，一个用于灵活侧链。对于 Vina Flex 模式，灵活侧链必须预先确定。我们确定所有具有侧链原子在配体原子 5 Å 范围内的残基为灵活的。在此模式中，蛋白质主链保持刚性。配体准备和网格盒设置与 VINA rigid docking 一致。

GNINA 的配体输入文件为 PDBQT 格式，使用 OpenBabel 创建，并使用 RDKit 添加氢原子。蛋白质输入文件为 PDB 格式文件。网格盒设置与 VINA rigid docking 一致。对于 PDBbind 数据集，所有配体-受体对都具有对接输出。对于 MDT 数据集，1 对没有输出，因为原始 PDB 文件（PDB ID：8HMU ）中的配体没有完全解析，缺少原子 。

GLIDE 是 Schrödinger 软件中的一个刚性蛋白质对接模块。配体由 LigPrep 模块准备。蛋白质准备使用 Protein Preparation Wizard 模块进行。网格文件由 Receptor Grid Generation 模块生成，具有 10 Å 内盒和自动外盒，围绕配体，六个面默认缓冲区为 4 Å，中心为配体的质心。然后执行 SP 精度对接。PDBbind 数据集中的某些配体是多肽，不能被 LigPrep 模块处理。此外，具有严重碰撞的配体与口袋原子没有对接输出。因此，266 个配体-受体对在 PDBbind 数据集和 472 个配体-受体对在 MDT 数据集中具有 GLIDE rigid docking 的对接输出 。

诱导适配对接（IFD）模块是 Schrödinger 软件中的一个蛋白质灵活对接功能。不同于 VINA 和 GNINA，不仅残基侧链可以移动，残基主链也可以稍微移动。配体准备和蛋白质准备与 GLIDE rigid docking 一致。搜索空间由默认参数定义，10 Å 内盒和自动外盒（与配体大小相似），中心为本地配体的质心。配体原子 5 Å 范围内的氨基酸残基被定义为灵活残基。对接过程在标准协议下执行，生成最多 20 个构象。总共 284 个配体-受体对在 PDBbind 数据集和 580 个配体-受体对在 MDT 数据集中使用 IFD 模块成功对接。诱导适配对接可以为更多 PDBbind 数据集中的配体-受体对生成输出构象，表明该对接方法可以通过移动口袋残基来扩展口袋 。

有关研究设计的更多信息，请参阅本文链接的 [Nature Portfolio Reporting Summary] 。

Fig. 1: a 全状态以粉色表示，初始apo状态和模型预测的构象以绿色表示。天然配体以青色表示，预测的配体以橙色表示。模型接受蛋白质和配体的当前构象和特征作为输入。输出结果包括预测的更新：配体和每个蛋白质残基的全局平移和旋转，配体的扭转角度和蛋白质残基的χ角度的旋转，以及两个预测模块（结合亲和力，A和置信度，D）。在训练阶段，模型被设计为学习从apo-like构象到全状态的转换。在推理阶段，模型迭代更新初始输入结构二十次。 b 一个示意图显示，当蛋白质与两个不同的配体结合时，我们的模型可以预测两个不同的全状态。我们的模型可以在20步内预测出结合的蛋白质构象，而全原子MD模拟需要数百万步才能找到相同的结合状态。

Fig. 2: a , b DynamicBind 在预测PDBbind数据集（ a ）和主要药物目标（MDT）数据集（ b ）的配体构象方面优于其他方法，跨越不同的RMSD阈值。 c 深色和浅色阴影分别表示严格（配体RMSD < 2 Å，碰撞得分  < 0.35）和宽松（配体RMSD < 5 Å，碰撞得分  <0.5）标准下的成功率。 d DynamicBind 预测的蛋白质构象更为天然，表明结合位点周围的口袋RMSD较低。 e DynamicBind 预测的contact-LDDT（cLDDT）得分与配体RMSD相关，并且是预测真实配体RMSD在2 Å以下（auROC 0.764）的良好预测指标。 f 随着生成样本数量的增加，成功率增加。 c – f 显示了PDBbind和MDT测试集的综合结果。个别数据集的结果，以及在30%、60%和90%的最大配体和蛋白质序列相似性截止值下筛选的结果，在补充图[1] –[4] 中有详细说明。源数据作为源数据文件提供。

Fig. 3: AlphaFold预测的结构以白色表示，晶体结构中的蛋白质和配体分别以粉色和青色表示。我们的模型预测结果以绿色和橙色表示，分别代表蛋白质和配体。Asp-Phe-Gly（DFG）残基的侧链以棒状表示。红色箭头突出晶体结构从AlphaFold结构中发生的显著构象变化。输入构象是AlphaFold预测的构象。 a 当配体84S（ b ）与c-Met蛋白质结合时，蛋白质采用DFG-in构象。当配体5I9（ d ）与相同蛋白质结合时，蛋白质采用DFG-out构象。我们对两种配体的预测（ c ， e ）与晶体结构一致。配体RMSD分别为0.49 Å和0.51 Å。从初始AlphaFold到预测结构的口袋RMSD改进分别为7.47 Å和4.83 Å，用于DFG-in和DFG-out。测试集中的七种蛋白质（由其UniProt ID标识），同时包含DFG-in和DFG-out晶体化全长构象，其初始AlphaFold和预测结构的口袋RMSD分别如（ f ， n = 39）和（ g ， n = 34）所示，用于DFG-in全长构象和DFG-out全长构象，中位数为中线，盒边表示上下四分位数，须状线延伸到1.5倍的四分位数范围，个别点以圆点表示。 h 所有79个PDB的口袋RMSD从AlphaFold改进的直方图。源数据作为源数据文件提供。

Fig. 4: 蛋白质在与小分子配体结合时会发生构象变化，这些变化可以在多个时间尺度上发生。负的Δ口袋RMSD表示预测结构相对于AlphaFold结构具有较低的RMSD。负的Δ碰撞意味着预测的配体与预测结构相比具有较低的碰撞评分，与AlphaFold结构中的移植配体相比。 a 精氨酸的侧链旋转，减轻了与配体的碰撞。 b AlphaFold结构中阻塞结合口袋的酪氨酸在预测结构中移开。 c AlphaFold结构的环区域与配体相交，在预测结构中重新定位。 d 结合位点附近的α螺旋转变为环，与晶体结构一致。 e Hsp90的α螺旋发生了显著的重新定位。 f 两个结构域合并，形成结合口袋。源数据作为源数据文件提供。

Fig. 5: a 只有六个 PDB 文件在训练集中具有与 SETD2 蛋白相似的 Smith-Waterman 相似度大于 0.4，并且所有这些都与 SAM 类似配体共晶化，如 ( b ) 中的线所示。PDB 7TY2 中的配体 EZM0414 以青色棒状表示，蛋白质以粉色表示。 c AlphaFold 结构中缺失了 EZM0414 的结合口袋，以白色表示。 d 本面板显示了训练集中配体与 EZM0414 相比的 Tanimoto 相似度，并绘制了前三个最相似的配体。 e DynamicBind 预测的蛋白质-配体复合物结构，以绿色表示蛋白质，以橙色表示配体。 f DynamicBind 预测的复合物结构与对应的晶体结构的叠加。源数据作为源数据文件提供。

Fig. 6: a 不同方法在抗生素基准测试中的虚拟筛选性能比较，衡量指标为 auROC（受试者操作特性曲线下面积）。基准测试涵盖了 n = 12 个不同的蛋白质系统。每个箱线图显示了中位数（中心线）、上下四分位数（箱边缘）、须线延伸到 1.5 倍的四分位数范围内，以及个别数据点（点）。我们忠实地纳入了基准测试论文中提出的所有六个基线数值 。 b AlphaFold 预测的蛋白质结构以白色表示，而 DynamicBind 为三个活性化合物生成的蛋白质结构以绿色表示。红色箭头指示蛋白质向配体移动，形成额外相互作用的区域。源数据作为源数据文件提供。

