DynamicBind: 预测配体特异性蛋白-配体复合物结构的深度等变生成模型

摘要: 尽管在预测静态蛋白质结构方面取得了显著进展，但由配体调节的蛋白质固有动态性对于理解蛋白质功能和促进药物发现至关重要。传统的对接方法通常用于研究蛋白质-配体相互作用，通常将蛋白质视为刚性。虽然分子动力学模拟可以提出适当的蛋白质构象，但由于生物学相关平衡态之间的稀有转变，它们在计算上要求很高。在本研究中，我们提出了DynamicBind，这是一种深度学习方法，采用等变几何扩散网络来构建平滑的能量景观，促进不同平衡态之间的高效转变。DynamicBind能够准确地从未结合的蛋白质结构中恢复配体特异性构象，而无需全结构或广泛采样。值得注意的是，它在对接和虚拟筛选基准测试中表现出最先进的性能。我们的实验表明，DynamicBind可以适应大范围的大型蛋白质构象变化，并识别出未见蛋白质靶标中的隐性口袋。因此，DynamicBind在加速开发针对以前不可药物化靶标的小分子药物方面显示出潜力，并扩展了计算药物发现的视野。

在蛋白质结构预测领域，从序列数据中取得了显著进展。一些预测技术结合了机器学习与分子动力学或蒙特卡罗方法, , ,。这些方法生成了一组结构。AlphaFold在预测几乎所有人类蛋白质组结构方面处于领先地位，然而，尽管蛋白质本质上是动态的，通常采用多种构象来执行其功能，AlphaFold通常仅为每个蛋白质序列生成少数几种构象, , , ,。蛋白质在不同构象之间相互转换的能力是其在所有生命领域中生物活性的核心。药物分子的治疗效果源于其仅与目标蛋白质的某些构象特异性结合，从而通过改变这些蛋白质的构象景观来调节重要的生物活性, , ,。在实践中，如今蛋白质与配体之间的相互作用通过分子对接方法进行计算研究。对接是基于结构的药物发现的关键组成部分 。然而，尽管普遍认识到蛋白质动态性的重要性，传统的对接方法通常将蛋白质视为刚性体，或者在某些情况下，仅允许选定的侧链移动，以控制计算成本,。因此，当AlphaFold预测的无配体蛋白结构用作对接输入时，产生的配体姿势预测与配体结合的共晶化全结构不一致,。AlphaFold预测的结构通常不呈现最有利于配体结合的侧链旋转构象，因此相关的结合口袋似乎不可访问，因为无配体蛋白采用的构象与全状态显著不同。

在此，我们提出了DynamicBind，一种为“动态对接”设计的几何深度生成模型。与将蛋白质视为大多刚性实体的传统对接方法不同，DynamicBind有效地将蛋白质构象从其初始的AlphaFold预测调整为类似全状态。我们的模型能够在预测过程中处理广泛的大构象变化，例如在激酶蛋白中著名的DFG-in到DFG-out转换，这是其他方法如分子动力学（MD）模拟所面临的巨大挑战,。我们通过学习一个漏斗状的能量景观，实现了对大蛋白质构象变化的高效采样，其中生物学相关状态之间的转换受到最小的挫折 。这通过在训练期间创新性地使用类似变形的转换来生成诱饵实现（更多内容见“DynamicBind架构”和“方法”）。当前方法与Boltzmann生成器有相似之处，因为它允许从学习的模型中直接高效地采样低能量状态。然而，与传统的Boltzmann生成器通常仅限于其训练的系统不同，DynamicBind是一个可推广的模型，可以处理新的蛋白质和配体,。

在接下来的结果部分中，我们对DynamicBind进行了全面评估，展示了其在药物发现中的潜力。我们的展示分为六个部分：首先，概述DynamicBind模型；然后将DynamicBind与当前对接方法进行基准测试；然后突出该方法在配体特异性方式中采样大蛋白质构象变化的能力；然后具体展示其可以处理的构象变化范围；通过案例研究展示其预测隐性口袋的能力；最后展示其在使用抗生素数据集进行蛋白质组范围虚拟筛选任务中的应用 。这些研究共同突出了DynamicBind的潜力，为进一步理解和操控蛋白质-配体相互作用景观奠定了基础。

DynamicBind执行“动态对接”，这一过程在预测蛋白质-配体复合物结构的同时，适应了显著的蛋白质构象变化。DynamicBind接受PDB格式的无配体样结构（在本研究中为AlphaFold预测的构象）和几种广泛可用格式的小分子配体，如简化分子输入线条条目系统（SMILES）或结构数据文件（SDF）格式。在推理过程中，模型随机将配体放置在蛋白质周围，其种子构象是使用RDKit生成的。然后，在20次迭代过程中（更多细节见“模型架构”），使用逐渐缩小的时间步长，模型逐渐平移和旋转配体，同时调整其内部扭转角。在最初的五个步骤中，仅改变配体构象，随后模型同时平移和旋转蛋白质残基，同时在剩余步骤中修改侧链chi角 。

如Fig. [1] a所示，在每一步中，蛋白质和配体的特征和坐标被输入到一个SE(3)-等变交互模块中。随后，蛋白质和读出模块生成当前状态的预测平移、旋转和二面角更新。关于模型的更多细节在“蛋白质构象的转变”中给出。与传统的扩散模型训练中使用不同幅度的高斯噪声扰动本征状态生成诱饵的协议不同，我们的方法使用类似变形的转换来生成蛋白质诱饵。在此过程中，本征构象逐渐过渡到AlphaFold预测的构象。蛋白质的结构在许多方面受到高度限制，残基通过肽键连接，键长由化学原理控制。当使用高斯噪声生成诱饵时，模型主要学习仅恢复到最化学稳定的构象，通常是添加噪声之前的构象。在当前任务中，配体结合的全构象是未知的，最容易获得的蛋白质结构是AlphaFold预测的结构，这通常与全构象显著不同。鉴于AlphaFold预测的结构通常已经符合大多数化学约束，难以预见仅从高斯噪声生成的诱饵训练的模型如何准确预测生物学相关的长时间尺度转变，这是我们主要关注的问题。相比之下，我们的类似变形转换生成的诱饵通常满足基本的化学约束，使我们的模型能够专注于学习生物物理相关的状态变化事件。在无偏分子动力学模拟中，亚稳态之间的转换，如DFG‘in’和‘out’转换，由于全原子力场固有的现实但崎岖的能量景观而不常见。相比之下，我们的方法具有显著更漏斗状的能量景观，有效降低了生物学意义状态之间的自由能障。因此，类似于其他Boltzmann生成器方法，当前方法在采样与配体结合相关的替代状态方面表现出显著增强的效率。已包含一个示意图以阐明这些差异（Fig. [1] b）,。

为了评估我们的方法，我们首先使用了PDBbind数据集，并根据之前的工作，使用时间顺序的方式对训练集、验证集和测试集进行划分。由于PDBbind测试集包含大约300个来自2019年的结构，其中包括许多非小分子配体（53个为多肽），我们通过使用精心挑选的主要药物靶点（MDT）测试集来扩展我们的评估范围。MDT集包括599个在2020年或之后存入的结构，包含来自四大主要蛋白质家族的药物样配体和蛋白质：激酶、GPCRs、核受体和离子通道（更多细节请参阅“数据集构建”）。这些蛋白质家族代表了大约70%的FDA批准的小分子药物的靶点, ,。

在测试过程中，我们没有使用holo结构作为输入，而是采用了一个更具挑战性和现实性的场景，即假设holo蛋白质构象不可用，仅使用AlphaFold预测的蛋白质构象作为输入。Holo构象与共结晶配体表现出强烈的形状和电荷互补性，这已经不切实际地简化了配体姿态预测 。相比之下，apo构象或AlphaFold预测的构象可能与通过叠加晶体结构获得的移植配体发生冲突 。

如图 [2] a和b所示，DynamicBind在配体RMSD低于各种阈值的情况下预测的案例比其他基线更多。特别是，它在PDBbind测试集上实现了配体RMSD低于2 Å（5 Å）的比例分别为33%（65%），在MDT测试集上分别为39%（68%）。

仅基于配体RMSD评估模型可能会偏向于深度学习模型（DiffDock、TankBind和DynamicBind），因为它们具有更高的冲突容忍度，而可能不利于严格执行范德华力的力场方法（GNINA、GLIDE、VINA）。显著的冲突会阻碍基于结构的药物设计中的相互作用分析，模糊关键的分子相互作用并使分子改进的设计复杂化。因此，我们使用配体RMSD和冲突评分（由Hekkelman等定义）来评估成功率。图 [2] c显示了使用严格标准（配体RMSD < 2 Å，冲突评分<0.35）和更宽松标准（配体RMSD < 5 Å，冲突评分 < 0.5）的成功率。在更严格的条件下，DynamicBind的成功率（0.33）是最佳基线DiffDock（0.19）的1.7倍。此外，DynamicBind已展示出相对于初始AlphaFold结构减少口袋RMSD的能力，即使在原始口袋RMSD较大的情况下（图 [2] d）。这一观察表明，当前的方法能够处理显著的构象变化，在其他方法可能困难的情况下恢复holo结构。鉴于我们模型生成多样化构象的能力，我们开发了contact-LDDT（cLDDT）评分模块，这一概念受AlphaFold的LDDT评分启发。该模块的目的是从预测输出中选择最合适的复合结构。如图 [2] e所示，我们预测的cLDDT与实际的配体RMSD高度相关，表明其在选择高质量复合结构方面的有效性。auROC评分，配体RMSD低于2 Å为真阳性，为0.764。虽然我们的cLDDT评分功能有效，但仍有改进的空间。完美的选择可以将我们的成功率从0.33提高到0.5，如图 [2] f所示。即使在没有理想选择模型的情况下，我们的方法也显著优于DiffDock和顶级力场方法GLIDE。由于Glide生成样本数量的可变性，通常是因为其过滤方案消除了不现实的构象，Glide的最佳性能用一条平线表示。这条线反映了由Glide最有效样本确定的成功率。DynamicBind的卓越性能源于其能够进行显著的蛋白质构象变化，从而在蛋白质和配体之间实现更好的契合 。

为了评估模型对新蛋白质和配体的泛化能力，我们分析了按与训练集的最大配体和蛋白质序列相似性分层的结果（补充图 [3] 和 [4] ）。该分析表明，DynamicBind在新配体方面表现良好，优于其他方法，但在新蛋白质方面效果较差，经典对接方法在预定义的真实结合口袋下表现更好。其他深度学习方法在新蛋白质方面也表现出类似的下降，暗示需要更大的训练集和改进的归纳偏差。此外，考虑到新蛋白质结合位点的识别是一个活跃的研究领域，深度学习方法（包括我们的方法）在盲全局对接中遇到的挑战可能在不同方法中是共享的。总体而言，DynamicBind在新配体方面的能力在药物发现中具有重要意义，突显了其在识别蛋白质构象变化方面的潜力，这对于创造有效的特定药物至关重要。

传统的对接协议通常将蛋白质构象采样作为与对接过程分开的步骤,。然而，在许多情况下，两种不同的配体可能适合于互斥的蛋白质构象。例如，c-Met激酶可以采用两种不同的构象，分别对应于活性和非活性状态，通常称为Asp–Phe–Gly (DFG)-in和DFG-out构象（Fig. [3] b, d）。DFG基序可以翻转，从而阻塞或打开蛋白质的不同区域。在以前的对接模型中，蛋白质必须预设为正确的构象，才能有机会识别配体的适当结合位姿 。相比之下，DynamicBind利用AlphaFold预测的蛋白质构象（Fig. [3] a），可以动态调整蛋白质构象以找到适合目标配体的最佳构象。作为一个代表性案例，对于PDB 6UBW，预测的配体RMSD为0.49 Å，口袋RMSD为1.97 Å，而AlphaFold结构的口袋RMSD为9.44 Å。对于PDB 7V3S，预测的配体RMSD为0.51 Å，口袋RMSD为1.19 Å，（AlphaFold 6.02 Å）。这两个配体在训练集中都未曾见过（Fig. [3] c, e）。在我们的定量分析中，测试集中只有七种蛋白质（在79个PDB结构中表示）被发现采用了DFG-in和DFG-out构象，这些构象由Kinase–Ligand Interaction Fingerprints and Structures (KLIFS)网络服务器注释 。图 [3] f和g展示了这些蛋白质（以其UniProt ID表示）如何从相同的初始结构开始，在与I型抑制剂结合时逐渐向DFG-in构象移动，并在与II型抑制剂相互作用时倾向于DFG-out构象。此外，Fig. [3] h显示，大多数预测的蛋白质结构与初始AlphaFold结构相比，显示出较低的口袋RMSD。这些结果表明，DynamicBind能够捕捉配体特异性的构象变化。此功能对于防止忽视可能与最初提供的蛋白质结构不同构象良好结合的潜在“命中”化合物至关重要。

DFG-in/out构象已被广泛研究，一些挑战可以通过采用集合对接来部分解决，其中两种构象的蛋白质都用于对接,。然而，集合对接增加了计算成本，可能不适合于特征不太明确的构象。在本节中，我们提供了对六种不同构象变化的全面分析，这些变化跨越了皮秒级到毫秒级的时间尺度，每种变化都由我们PDBbind测试集中的一个案例示例化。在Fig. [4] 中，晶体结构以粉色显示，AlphaFold结构以白色显示，而我们的预测以绿色显示。天然配体以青色显示，我们预测的配体以橙色显示。Δpocket RMSD测量预测的蛋白质结构与AlphaFold结构之间的口袋RMSD差异，基于与晶体结构的比较。负的Δpocket RMSD表示预测的结构与晶体结构相比更接近于AlphaFold预测。Δclash测量预测的蛋白质-配体对与AlphaFold结构和移植的配体之间的冲突分数差异 。负的Δclash表示预测的复合物中冲突较少。在Fig. [4] a中，天然配体与叠加的AlphaFold结构的一个侧链发生冲突；在我们的预测中，这个侧链向天然构象移动，从而解决了冲突。在Fig. [4] b中，AlphaFold结构中的一个酪氨酸阻塞了口袋的一部分；在我们的预测和天然结构中，它变得可访问。在Fig. [4] c中，一个柔性环与配体相交，在我们的预测中，它移开，与天然结构一致。在Fig. [4] d中，靠近配体结合位点的α螺旋转变为环。在Fig. [4] e中，热休克蛋白Hsp90α 中观察到显著的二级结构运动，从闭合状态过渡到开放状态。在Fig. [4] f中，AKT1激酶的两个结构域合并，形成了一个以前不存在的口袋。综上所述，当配体结合口袋在AlphaFold预测的构象中不够宽敞或未形成时，当前模型可以预测与配体结合相关的多种构象变化。

蛋白质的动态特性常常导致隐性口袋的出现。这些隐性口袋在蛋白质动态过程中出现，可以揭示静态结构中未发现的可成药位点，从而使以前“不可成药”的蛋白质成为潜在的药物靶点。我们通过使用包含SET结构域的蛋白质2（SETD2），一种组蛋白甲基转移酶，作为案例研究，展示了DynamicBind在揭示这些隐性口袋方面的实用性。SETD2对于多发性骨髓瘤（MM）和弥漫性大B细胞淋巴瘤（DLBCL）的治疗至关重要，具有一个由高度选择性化合物EZM0414靶向的隐性口袋，该化合物目前正在进行I期临床试验。如图Fig. [5] a, b所示，训练集中所有SETD2同源物的蛋白质Smith–Waterman相似性超过0.4，均与S-腺苷甲硫氨酸（SAM）或Sinefungin类似物共结晶，显示为线条。Sinefungin及其类似物通过占据SAM位点广泛抑制甲基转移酶，使得SETD2的选择性抑制具有挑战性。在2019年之前，没有SETD2或其同源物的结构与靶向EZM0414的位点结合的化合物结晶（显示为青色棒）。因此，我们的模型没有在任何与此新识别位点结合的化合物结构上进行训练。在Fig. [5] c中，AlphaFold结构及其表面显示为白色。隐性位点似乎被阻塞，与移植的EZM0414发生了显著冲突。图Fig. [5] d确认EZM0414是一个未见过的配体，即使是最相似的Tanimoto配体也与EZM0414有显著偏离。图Fig. [5] e显示了我们模型预测的蛋白质-配体复合物结构，采用AlphaFold预测的SETD2结构和EZM0414的SMILES表示作为输入。图Fig. [5] f将我们的预测与SETD2-EZM0414复合物的晶体结构（PDB 7TY2）叠加。结果配体RMSD为1.4 Å，口袋RMSD为2.16 Å。此外，我们在补充信息中包含了来自Cryptosite数据集的几个案例，这些案例与我们的训练集具有低序列相似性,。

在基于靶标的药物发现中，潜在药物候选物的筛选和反向筛选（即为特定化合物识别蛋白质靶标）都是至关重要的。这些过程需要在蛋白质组水平上准确预测结合亲和力，即蛋白质与化合物之间相互作用强度的度量。因此，我们在模型中添加了一个亲和力预测模块，使用PDBbind数据集中的实验测量结合亲和力数据进行训练。为了在真实世界的虚拟筛选场景中评估DynamicBind，我们使用了最近发布的抗生素实验基准 。该数据集包括2616个蛋白质-化合物对的面板，其中没有一个在我们的训练阶段遇到过。它包含来自大肠杆菌基本蛋白质组的12种蛋白质与218种活性抗菌化合物配对。图Fig. [6] a显示，DynamicBind超越了VINA和DOCK6.9等常见对接方法以及最佳的基于机器学习的重新评分方法，达到了0.68的接收者操作特征曲线下面积（auROC）的平均值。基线数字直接来源于基准论文 。这种性能提升归因于DynamicBind的动态对接能力，它将AlphaFold结构优化为更接近天然状态，从而导致更精确的结合亲和力估计。如图Fig. [6] b所示，预测的蛋白质murD结构更紧密地围绕配体，形成了初始AlphaFold结构无法实现的更多相互作用。这项抗生素基准评估与我们在PDBbind测试集上的结合亲和力预测基准一致（补充表格 [1] ），其中DynamicBind始终优于传统对接方法和基于深度学习的刚性对接方法。这些结果表明，DynamicBind凭借其结合亲和力预测能力，在蛋白质组水平的虚拟筛选应用中展现出显著潜力。

DynamicBind将传统上分开的两个步骤，即蛋白质构象生成和配体位姿预测，统一到一个框架中。作为一种端到端的深度学习方法，它在采样广泛的蛋白质构象变化方面比传统的MD模拟快了几个数量级。与需要预定义结合口袋的传统对接方法不同，DynamicBind具有执行全局对接的能力，这一特性在结合口袋尚未被识别时变得至关重要。这些优势使DynamicBind能够对结合于隐性口袋的化合物进行虚拟筛选。这些化合物可能仅与目标蛋白质结合，从而可能最大限度地减少副作用。此外，DynamicBind可以预测新的药物候选物是否可能与非预期的蛋白质靶标结合，或者可以在通过表型筛选发现活性化合物时帮助识别结合靶标。

尽管DynamicBind在我们的基准测试中表现出最先进的性能，但仍有改进的空间，特别是在增强其对比训练集中的蛋白质具有低序列同源性的蛋白质的泛化能力方面,。作为一个数据驱动的模型，它显著受益于冷冻电镜方法的快速进步, ,。这些技术进步将扩大我们训练数据的多样性和全面性，以更快的速度提供更多样化的蛋白质-配体复合物构象。此外，通过利用大量非结构性结合亲和力数据，DynamicBind还有改进的潜力，这些数据目前比结晶结构更为丰富。通过采用类似于AlphaFold的自蒸馏方法，我们可以通过整合以前仅有亲和力数据的蛋白质-配体对的高置信度预测的复合物结构来扩充我们的训练集 。

总之，DynamicBind 提出了一种“动态对接”方法来研究蛋白质-配体相互作用，使其区别于将蛋白质视为静态的传统对接方法和计算要求高的分子动力学 (MD) 模拟。其大规模蛋白质动态能力对药物分子的发现具有特别重要的意义，尤其是那些针对隐性口袋的药物。此外，DynamicBind 生成的配体特异性蛋白质构象可能为配体对蛋白质的影响提供有价值的见解，潜在地澄清结构-功能关系并增强我们的机制理解。

我们的模型是一个 E(3)-等变、基于扩散的图神经网络，利用粗粒度表示。

E(3)-等变模型根据应用于三维空间中输入x 的转旋和奇偶操作来变换输出y 。研究表明，等变模型可以用少 1000 倍的数据进行训练，同时在大块水的结构上产生更优的结果 。尽管冷冻电子显微镜和晶体学取得了重大进展，现有的蛋白质-配体复合物数据库仍然相对有限，仅扩展到数万的规模。因此，需要一个高效的模型，能够识别最相关的信息，并避免在重新定位或旋转整个结构时不成立的表面信息。实现 SO(3) 对称性的传统方法涉及仅使用或预测不变量，例如接触图。然而，接触或距离图并不总是与物理上可行的配置相关。例如，一个残基可能被预测为与两个相距甚远的原子接触。此外，接触图可能忽略手性，这是药物发现中的一个重要方面 。

作为一个基于扩散的模型，DynamicBind 通过一个过程进行训练，该过程以不同程度逐渐扭曲本征构象，使模型能够学习如何恢复正确的构象。扭曲原始配置通常涉及向原子添加位移高斯噪声。在化学键施加的键距约束和范德华力强制的排除体积效应下，当扭曲相对较小时，从这种扭曲中恢复是直接的。然而，我们观察到仅仅添加高斯噪声不足以训练一个可以预测从一个生物学上有意义的配置到另一个配置的模型。为了解决这个问题，我们引入了一种类似变形的变换，在晶体蛋白质结构和 AlphaFold 预测的结构之间进行插值，从而降低了亚稳态配置之间的过渡障碍，例如 AlphaFold 预测的构象和配体结合的 holo 构象。与其他训练评分函数的生成模型不同，s θ(x , t)≈ ∇ log p t(x)，我们的扩散架构旨在将扰动结构直接映射回原始构象，类似于一致性模型,。模型的输出表示为f θ xt , t = − ϕ xt , t ，其中ϕ xt , t 表示添加到本征构象的类似变形的变换。

传统方法使用全原子表示，明确建模每个原子的坐标。然而，由于原子通过化学键连接，且局部几何高度受限——例如，苯环通常是平的，原子并不独立移动。为了减少这些非物理配置的自由度数量，我们采用了蛋白质和配体的粗粒度表示。在我们的模型中，每个蛋白质残基由一个节点表示，具有两个向量——坐标和方向，以及侧链二面角。更多细节在“特征化”中提供。对于配体，每个重原子由一个节点表示，这些节点以外在到内在的方式变换，其中扭转角的变化转换为笛卡尔坐标的变化 。附加细节可以在“配体构象的变换”中找到。值得注意的是，尽管是粗粒度表示，所有非氢原子的坐标仍然可以一对一映射。

我们模型的输入是蛋白质和配体的当前构象。输出包括对每个配体的k 标量扭转角和两个平移-旋转向量的预测更新，以及对每个蛋白质残基的k i p 标量二面角和两个主链的平移-旋转向量的更新。更多细节可以在“蛋白质构象的转化”中找到。此外，模型还生成两个标量输出：一个用于估计由cLDDT（接触-LDDT）评估的本构象程度，另一个用于预测蛋白质和配体之间的结合亲和力 。

在我们的模型中，配体是一个属性图G l =(Vl , El)，其中每个节点v i l ∈ V l 代表一个重原子，芳香键、单键、双键或三键作为边。配体图的节点特征包括原子序数、手性、度和形式电荷。除了键类型外，边长嵌入也用作标量边特征。

蛋白质图表示为G p =(Vp , Ep)，其中每个节点v i p ∈ V p 对应于C α位置的一个残基。蛋白质图中的节点特征包括氨基酸类型、来自esm 的语言模型嵌入和侧链二面角，这些角度表示为(7 × 2)维零填充标量特征（每个氨基酸的五个可旋转chi角[chi1, chi2,..., chi5]和两个对称chi角[altchi1, altchi2]，这些角度被转换为正弦和余弦值）。为了确保给定结构的侧链角度的唯一性，我们始终将其处理为[max( chi1,altchi1 ), min( chi1,altchi1 ), max( chi2,altchi2 ), min( chi2,altchi2 ), chi3, chi4, chi5]。此外，主链方向表示为两个单位向量特征，分别是xN − xCαxN−xCα 和xC − xCαxC−xCα 。对于边，长度嵌入用作标量特征。我们对氨基酸的特征化使模型能够推断出所有重原子的位置。

DynamicBind是一个使用等变和不变特征的图神经网络。它根据e3nn库中的定义，使用不可约表示（irreps）的张量积来传播信息 。

节点和边的输入标量特征与扩散时间的正弦嵌入连接，然后由不同的多层感知器（MLPs）编码。对于蛋白质节点，氨基酸的两个单位向量特征与新的标量表示结合，形成交互层的初始特征。类似于DiffDock，在图传播过程的每一步中，配体和蛋白质图都经历一次内部交互和一次外部交互。在配体的内部交互中，每个配体原子的表示由距离5Å内的其他配体原子更新。对于蛋白质，每个氨基酸由距离15Å内的其他氨基酸更新。为了减少模型的训练运行时间和内存使用，每个残基最多允许24个邻居。外部交互的边缘是基于氨基酸是否在距离任何配体原子(3σ t  r+ 12) Å内确定的，其中σ t  r是当前扩散平移噪声的标准差。这个动态截止旨在确保即使配体远离受体时也存在互连。当σ t  r较大时，互连仍然存在。在确定连接图后，节点的消息由TensorProductLayer更新。具体来说，对于属于类别c a的每个节点a： 1 h a ← h a ⊕ c ∈{  ℓ,r  }BNca,c1∣Na ( c ) ∣∑b∈Na ( c ) Yrab⊗ψabhbwithψ a b = Ψca,ceab , ha0 , hb0 这里，h a表示节点的特征，h a 0 表示其标量特征。N a(  c  )指的是类别c （配体或蛋白质）的节点a 的邻居。球谐函数表示为Y ，BN表示（等变的）批量归一化。模块Ψ是一个MLP，包含用于张量积的可学习权重，这些权重是基于边嵌入e a  b和标量特征h a 0 , h b 0 。

在最终的交互层之后，节点表示用于生成输出。为了生成cLDDT、结合亲和力、配体的平移和旋转预测，采用每个配体原子与配体几何中心的卷积： 2 v = 1 ∣ Vℓ ∣ ∑ a ∈ Vℓ Y roa ⊗ ψoa h awithψ o a = Ψ eoa , ha0 其中e o  a是配体几何中心与配体节点a之间的边嵌入。输出v 由144个偶标量、2个奇向量和2个偶向量组成。标量用于预测cLDDT (D)和结合亲和力的负对数 (A)，以浓度单位测量。 3 D =MLP (vscalar  [  :72  ] )4 A =clamp MLP( vscalar [ 72:144 ])D+ eps , min = 0 , max = 15 奇向量用于预测配体平移，而偶向量用于预测配体旋转：5 tr l =v ¯ vectorodd∥v ¯ vectorodd∥ +  eps×MLP∥v ¯ vectorodd∥ ,st 6 rot l =v ¯ vectoreven∥v ¯ vectoreven∥ +  eps×MLP∥v ¯ vectoreven∥ ,st  with  v ¯  v e c t o r = vvector [ 0 ]  +vvector [ 1 ]  2 这里，  st  是扩散时间的正弦嵌入，eps = 10用于数值稳定。根据Jing等人的研究，我们的模型为每个可旋转的配体键预测一个标量扭转更新。对于键  b ，扭转更新T b l 是通过键中心  o 上的半径图的每个原子的卷积生成的：7 T b l =MLP  1∣Nb∣∑a∈NbY  ( roa )  ⊗Y2 ( rb ) ⊗γoaha  withγ o a = Γ eoa,ha0,hb00+hb10.

为了预测蛋白质的构象变化，我们需要更新每个蛋白质节点的侧链chi、平移和旋转。这些操作是从每个氨基酸的最终交互表示h i生成的： 8 T i p =MLPhi,scalarodd , hi,scalareven 9 tr i p = h ¯ i,vectorodd ∥h ¯ i,vectorodd ∥ +eps×MLP∥h ¯ i,vectorodd ∥ , st 10 rot i p = h ¯ i,vectoreven ∥h ¯ i,vectoreven ∥ +eps×MLP∥h ¯ i,vectoreven ∥ , stwithh  ¯i , v e c t o r = 1 ∣ Ni ∣ ∑ j ∈ Ni h i , v e c t o r j 这里，T i p 是一个五维标量输出，表示[chi1, chi2,..., chi5]的扭转更新。

为了更新配体构象，我们采用统一的全局平移tr l ∈ R 3 和旋转R l ∈ R 3 × 3 。配体的所有原子将同时围绕配体的几何中心进行平移和旋转，几何中心计算为x  ¯l = 1 n ∑ x i l ，其中n 是配体的重原子总数，x i l 表示原子i 的位置向量 。具体来说，变换后的位置向量x 获得为x l = R l(xl −x ¯ l)+ x  ¯l + tr l 。

In addition to translation and rotation, torsion angles are also crucial factors in determining the ligand conformation. However, modifying torsion angles can perturb the position of the center of mass of the ligand. To address this issue, Corso et al. demonstrated that performing an RMSD alignment after updating the torsion angles can ensure that the effect of the torsion updates is orthogonal to the roto-translation updates, and thus decouple the consequences of torsional updates and roto-translation updates. Overall, the updated ligand pose is obtained asx l = RMSDAlign( ( T0l∘⋯Tkl ) ( xl ), Rl  ( xl−x ¯ l )+x ¯ l + trl), whereT k l is the torsion rotation.

Following AlphaFold, we use Cα as the residue node to perform global translation and rotation. Additionally, the model predicts the updates of side-chain torsion angles. For 180-rotation-symmetric side-chain parts, considering symmetry is unnecessary in the inference stage, but we introduce symmetry side-chain torsion features during training to correctly compute the loss function. Since the position of the Cα is independent of the side-chain torsion angles, rotating the side chain does not affect the residue-level translation and rotation. Thus, we can perform roto-translations and torsion rotations in any order. Finally, the updated conformation of each protein residue is represented asx i p =(Ti,0p ∘ ⋯ Ti,kp) (Rip  ( xip−xi,cαp )+ xi,cαp + trip), whereT i , k p is the side-chain torsion rotation ofi th residue.

During the training process, the input are the protein structure in decoy conformation constructed by adding morph-like transformation to the native conformation and the ligand structure in conformation with Gaussian noise added. The expected output are the denoising operations. The input protein structure at time t is defined asx t p = ϕ(xholo , t). Specifically, for thei th amino acid, the Kabsch algorithm is used to calculate the translationtr i * and rotationrot i * aroundCα that aligns the backbone atomsN −Cα −C of the holo-structure to the apo structure: 11tri*,roti*=  Kabsch xi, ( N  , C α ,  C ) holo−xi,C  αholo,xi, ( N  , C α ,  C ) apo−xi,C  αholoConsidering the differences in torsion angles, we can draw the conformation changes ofi th residue: 12xiapo= ϕxiholo=  ( Ti,0*∘⋯Ti,k* ) Ri*x  i  h  o  l  o−x  i  , C α h  o  l  o+xi,C  αholo+tri*Here,T i , k * = T i , k a p o − T i , k h o l o are in radian and theR i * is the rotation matrix ofrot i *. At any given moment, we aim to perturb the protein structure using a factor, denoted asu (t ), such that the perturbed data is an intermediate state between the holo-structure and apo structure: 13 ϕ xiholo , t = Δ Ti,0p ∘ ⋯ Δ Ti,kp Δ Ripxiholo−xi,Cαholo+ xi,Cαholo + Δ tripwithΔ tr i p = u(t)tr i * Δ R i p =Rotation matrix ofu(t)rot i * Δ T i , k p = u(t)T i , k * + N(0 , 0.3)u(t)=clampτminp +( τmaxp−τminp )×  ( 5t ) 0.3 , min = 0 , max = 1 whereτ m i n p andτ m a x p represent the parameters of the diffusion noise.

为了克服由于在推理过程中使用RDKit生成的构象作为起始点而导致的训练和推理之间的分布偏移，我们用与真实姿态x,匹配的构象x 0 l 替换训练目标。在时间t ，输入的配体姿态是一个随机扰动的构象： 14 x t l =(Δ T0l ∘ ⋯ Δ Tkl) (Δ Rl  ( x0l−x ¯ 0l )+x ¯ 0l + Δ trl) withΔ tr l = N 0,σtrl, N 0,σtrl, N 0,σtrl Δ R l =Rotation matrix of sampling fromp(ω)ω ̂ Δ T k l = N 0 , σtorl p(ω)= 1 − c o s(  ω  )π ∑ l = 0 ∞(2 l + 1)exp − l(  l+1  )( σrotl ) 2 sin(( l+1/2 ) ω  )sin(  ω/2  )这里，x  ¯0 l 是x 0 l , p(ω)的几何中心，ω ̂ 是通过随机采样生成的单位向量。

网络通过八种损失进行训练。总损失可以定义如下 15L =13Ltrl+13Lrotl+13LTl+13Ltrp+13Lrotp+13LTp+ 0.01LA+ 0.99LD其中L tr l , L rot l , L T l 分别是配体的平移、旋转和扭转损失。L tr p , L rot p 和L T p 是蛋白质残基的损失。L A 是结合亲和力损失，L D 是接触-LDDT损失。用于计算真实cLDDT的距离差异为d = ∣ d(x0l , xholo)− d(xtl , xtp)∣  （更多关于cLDDT分数计算的细节可以在“评估指标”中找到）。

由于旋转向量u 与另一个v 表示相同的旋转，如果u 和v 具有相反的方向且∥u ∥ + ∥v ∥ = 2π 。因此，在计算旋转损失时，我们取正向和反向方向损失的最小值。扭转角度损失是通过预测值与添加的扭转角度噪声之间的角度差的余弦来计算的。完整的训练过程可以在补充算法 [1] 中看到。

在推理过程中，我们使用由RDKit生成的构象的配体结构和由AlphaFold预测的蛋白质结构作为初始复合物构象。复合物结构经过20步更新。为了防止最终构象陷入局部最小值，在每一步中，都会向去噪的配体姿态添加一个小的随机噪声。对于每对，我们进行40次采样，并根据预测的cLDDT对结合构象进行排序。我们还注意到，预测的结合亲和力的加权平均值是实验测量亲和力的更准确估计（补充表 [1] ）。预测的cLDDT值用作权重。完整的推理过程可以在补充算法 [2] 中找到。

DynamicBind拥有6367万个参数，并在八个Nvidia A100 80GB GPU上训练了5天。

为了评估预测的复合结构中蛋白质与配体之间的相互作用，我们确定分子间天然接触形成的程度。我们采用类似于局部距离差异测试（LDDT）分数的定义，该分数以前用于量化预测蛋白质结构的天然性 。接触-LDDT（cLDDT）分数是通过考虑所有配体原子和蛋白质原子对之间小于15Å的距离来计算的。距离差异是在真实结构和预测的复合结构之间确定的，同时考虑对称性。最终的cLDDT分数是从四个容差阈值（0.5、1、2和4Å）下的保留距离的平均分数中得出的。

为了评估预测的蛋白质结构与结合口袋周围的天然蛋白质结构的偏差，我们计算口袋均方根偏差（pocket RMSD）。这是通过使用位于参考配体原子5Å范围内的蛋白质原子来进行的。最初，预测的蛋白质结构与晶体蛋白质结构对齐。随后，确定预测的口袋原子与晶体口袋原子之间的RMSD。

类似于AlphaFill，碰撞分数是配体原子和蛋白质原子之间所有距离的范德华重叠的均方根（RMS），这些距离小于4Å。其计算如下： 16 碰撞分数  =∑  i  =  0  N范德华重叠i  2N其中N 是考虑的距离数量 。

我们的训练和测试数据集基于PDBbind2020数据库构建，其中包括19,443个蛋白质-配体复合物的晶体结构的精选集合，每个结构都配有实验测量的结合亲和力。我们采用与先前工作相同的时间分割，使用2019年之前存储的结构进行训练和验证，而2019年存储的结构则用于测试。每个蛋白质都与对应的AlphaFold预测结构对齐。对齐的AlphaFold结构和晶体结构通过类似变形插值生成蛋白质部分的训练样本。主要药物靶点（MDT）测试集是根据以下标准构建的：2020年或之后存储的PDB；属于四大主要药物靶点组之一的蛋白质 - 激酶、GPCRs、核受体和离子通道；AlphaFold预测的蛋白质结构与晶体结构的口袋RMSD超过2Å（或口袋LDDT低于0.8）；配体是分子量在200到650道尔顿之间的药物样小分子；每个研究最多包含10个PDB。这些标准确保测试集具有挑战性，初始输入蛋白质与天然构象不同，并且具有代表性，涵盖了广泛的蛋白质靶点。此外，它防止少数蛋白质主导整个测试集，因为某些研究存储的PDB数量显著多于其他研究，结构相同的蛋白质与略有不同的配体共结晶, ,。

我们在PDBbind测试集（303个配体-受体对）和主要药物靶点（MDT）测试集（599个配体-受体对）上使用以下列出的不同对接方法进行了对接。对接配体从共结晶结构中提取，而不改变其原子坐标，对接受体结构由AlphaFold预测。我们使用对称感知方法，特别是spyrmsd包中的symmrmsd函数进行所有RMSD计算 。

在 Autodock Vina 中，配体通过 Meeko 2.0.0 从 SDF 格式转换为 PDBQT 格式。蛋白质准备是通过使用 ADFR Suite 1.0 中的“prepare_receptor”命令进行的。对接盒是通过在本地配体周围使用自动盒定义的，默认缓冲区为所有六个侧面各 4 Å。盒子的中心是本地配体的质心。由于硼原子不是有效的 AutoDock 原子类型，含有该原子的配体无法进行对接。因此，在 PDBbind 数据集中只有 301 对配体-受体对，在 MDT 数据集中有 597 对配体-受体对在 VINA 刚性对接中有对接输出 。

与 VINA 刚性对接相比，VINA 灵活对接中增加了一个灵活受体准备步骤。该步骤是通过一个名为“prepare_flexreceptor.py”的 Python 脚本执行的，该脚本可在https://github.com/ccsb-scripps/AutoDock-Vina/tree/develop/example/autodock_scripts 获取。通过此步骤，蛋白质 PDBQT 格式文件被分为两个 PDBQT 格式文件，一个用于刚性部分，一个用于灵活的侧链。对于 Vina Flex 模式，必须预先确定灵活的侧链。我们将所有侧链原子在配体原子 5 Å 范围内的残基识别为灵活的。在这种模式下，蛋白质主链保持刚性。配体准备和网格盒设置与 VINA 刚性对接一致。

GNINA 的配体输入文件是 PDBQT 格式，使用 OpenBabel 在添加氢后由 RDKit 创建。蛋白质输入文件是 PDB 格式文件。网格盒设置与 VINA 刚性对接一致。对于 PDBbind 数据集，所有配体-受体对都有对接输出。对于 MDT 数据集，有 1 对没有输出，因为原始 PDB 文件中的配体（PDB ID:8HMU ）未完全解析，缺少原子 。

GLIDE 是 Schrödinger 软件中的一个刚性蛋白质对接模块。配体通过使用 LigPrep 模块进行准备。蛋白质准备是通过使用 Protein Preparation Wizard 模块进行的。网格文件是通过 Receptor Grid Generation 模块生成的，内盒为 10 Å，外盒自动围绕配体，默认缓冲区为所有六个侧面各 4 Å，中心在配体的质心上。然后，进行 SP 精密对接。PDBbind 数据集中的一些配体是多肽，无法通过 LigPrep 模块处理。此外，与口袋原子严重冲突的配体在对接过程中没有输出姿势。因此，在 PDBbind 数据集中有 266 对配体-受体对，在 MDT 数据集中有 472 对配体-受体对在 GLIDE 刚性对接中有对接输出 。

Schrödinger 软件中的诱导契合对接（IFD）模块为用户提供了蛋白质灵活对接功能。与 VINA 和 GNINA 不同，不仅残基侧链，而且残基主链也可以稍微移动。配体准备和蛋白质准备与 GLIDE 刚性对接相同。搜索空间由默认参数定义，内盒为 10 Å，外盒自动大小（与配体大小相似），中心在本地配体的质心上。配体原子 5 Å 范围内的氨基酸残基被定义为灵活残基。对接过程在标准协议下进行，最多生成 20 个姿势。总共，使用 IFD 模块成功对接了 PDBbind 数据集中的 284 对配体-受体对和 MDT 数据集中的 580 对。诱导契合对接可以为 PDBbind 数据集中的更多配体-受体对成功提供输出姿势，比 GLIDE 刚性对接更多，表明这种对接方法可以通过移动口袋残基来扩展口袋 。

有关研究设计的更多信息，请参见链接到本文的 [Nature Portfolio Reporting Summary] 。

Fig. 1: a 全结合态以粉色表示，初始apo态和模型预测构象以绿色表示。天然配体以青色显示，预测配体以橙色显示。模型接受蛋白质和配体的特征和当前构象作为输入。输出包括预测的更新：配体和每个蛋白质残基的全局平移和旋转，配体的扭转角和蛋白质残基的chi角的旋转，以及两个预测模块（结合亲和力，A和置信度评分，D）。在训练阶段，模型被设计为学习从apo样构象到全结合构象的转变。在推理过程中，模型迭代更新初始输入结构二十次。 b 示意图显示了当蛋白质与两个不同的配体结合时，我们的模型可以预测两种不同的全结合构象。我们的模型可以在20步内预测结合的蛋白质构象，而全原子MD模拟需要数百万步才能找到相同的结合状态。

Fig. 2: a , b DynamicBind在预测PDBbind数据集（ a ）和主要药物靶点（MDT）数据集（ b ）的配体构象方面优于其他方法，跨越不同的RMSD阈值。 c 深色和浅色阴影分别表示在严格（配体RMSD < 2 Å，碰撞评分 < 0.35）和宽松（配体RMSD < 5 Å，碰撞评分 <0.5）标准下的成功率。 d DynamicBind预测的蛋白质构象更接近天然状态，这从结合位点周围较低的口袋RMSD中可以看出。 e DynamicBind预测的接触-LDDT（cLDDT）评分与配体RMSD高度相关，是预测真实配体RMSD低于2 Å的良好指标（auROC 0.764）。 f 随着生成样本数量的增加，成功率也增加。 c – f 显示了PDBbind和MDT测试集的组合结果。单个数据集的结果，以及在30%、60%和90%最大配体和蛋白质序列相似性截止值下过滤的结果，详见补充图。[1] –[4] 。源数据提供为源数据文件。

Fig. 3: AlphaFold 预测的结构以白色显示，晶体结构中的蛋白和配体分别以粉色和青色显示。我们的模型预测结果中，蛋白和配体分别以绿色和橙色显示。Asp–Phe–Gly (DFG) 残基的侧链以棒状显示。红色箭头突出显示了晶体结构与 AlphaFold 结构之间的显著构象变化。输入构象是 AlphaFold 预测的构象。 a 当配体 84S ( b ) 结合到 c-Met 蛋白时，蛋白采用 DFG-in 构象。当配体 5I9 ( d ) 结合到同一蛋白时，蛋白采用 DFG-out 构象。我们对这两种配体的预测 ( c , e ) 与晶体结构非常一致。配体 RMSD 分别为 0.49 Å 和 0.51 Å。DFG-in 和 DFG-out 的初始 AlphaFold 口袋 RMSD 改进分别为 7.47 Å 和 4.83 Å。在测试集中，七种蛋白（通过其 UniProt ID 识别）包含 DFG-in 和 DFG-out 晶体化的 holo 构象，它们的初始 AlphaFold 和预测结构的口袋 RMSD 分别显示在 ( f , n = 39) 和 ( g , n = 34) 中，DFG-in 和 DFG-out holo 构象分别显示，其中中央线标记中位数，箱体边缘表示上四分位数和下四分位数，须线延伸至 1.5 倍四分位距，单个点以点状显示。 h 所有 79 个 PDB 的 AlphaFold 口袋 RMSD 改进的直方图。源数据作为源数据文件提供。

Fig. 4: 蛋白在与小分子配体结合时会经历跨越多种时间尺度的构象变化。负的 Δpocket RMSD 表示预测结构相对于 AlphaFold 结构与真实值的 RMSD 更低。负的 Δclash 表示预测的配体与预测结构的冲突得分低于与 AlphaFold 结构的移植配体。 a 精氨酸的侧链旋转，减轻了与配体的冲突。 b AlphaFold 结构中阻碍结合口袋的酪氨酸在预测结构中移开。 c AlphaFold 结构的环区与配体相交，并在预测结构中重新定位。 d 结合位点附近的α螺旋转变为环，与晶体结构对齐。 e Hsp90 的α螺旋经历了显著的重新定位。 f 两个结构域合并，从而形成结合口袋。源数据作为源数据文件提供。

Fig. 5: a 训练集中只有六个PDB与SETD2蛋白的Smith–Waterman相似性大于0.4，并且所有这些都与类似SAM的配体共同结晶，也在( b )中以线条显示。PDB 7TY2的配体EZM0414以青色棒状显示，蛋白质以粉色显示。 c 在AlphaFold结构中，EZM0414的结合口袋缺失，以白色显示。 d 此面板显示了训练集中配体与EZM0414的Tanimoto相似性，并绘制了前三个最相似的配体。 e DynamicBind预测的蛋白-配体复合物结构，蛋白质以绿色表示，配体以橙色表示。 f DynamicBind预测的复合物与相应的晶体结构的叠加。源数据提供为源数据文件。

Fig. 6: a 通过不同方法对抗生素基准测试的虚拟筛选性能进行比较评估，以auROC（ROC曲线下面积）衡量。该基准测试包含 n = 12个不同的蛋白质系统。每个箱线图显示中位数（中央线）、上四分位数和下四分位数（箱边缘）、延伸至1.5倍四分位距的须以及单个数据点（点）。我们忠实地纳入了基准论文中提出的所有六个基线数字 。 b AlphaFold预测的蛋白质结构以白色显示，而DynamicBind为三个活性化合物生成的蛋白质结构以绿色显示。红色箭头指示蛋白质向配体靠近的区域，形成额外的相互作用。源数据提供为源数据文件。

