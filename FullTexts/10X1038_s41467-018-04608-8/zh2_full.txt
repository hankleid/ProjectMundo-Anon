利用對比主成分分析探索數據集中增強的模式

摘要: 高維數據的可視化和探索是各學科中普遍的挑戰。廣泛使用的技術如主成分分析（PCA）旨在識別單一數據集中的主要趨勢。然而，在許多情況下，我們擁有在不同條件下收集的數據集，例如，處理組和對照組實驗，我們感興趣的是可視化和探索特定於一個數據集的模式。本文提出了一種方法，對比主成分分析（cPCA），它識別相對於比較數據增強的低維結構。在各種實驗中，我們證明了使用背景數據集的cPCA使我們能夠可視化PCA和其他標準方法所忽略的數據集特定模式。我們進一步提供了cPCA的幾何解釋和強有力的數學保證。cPCA的實現是公開可用的，可以用於許多目前使用PCA的應用中的探索性數據分析。

主成分分析（PCA）是數據探索和可視化中最廣泛使用的方法之一 。PCA將數據投影到低維空間，特別適合用於可視化數據集中的模式，如聚類、梯度和異常值 。有許多相關的可視化方法；例如，t-SNE和多維尺度分析（MDS）允許非線性數據投影，可能比PCA更好地捕捉非線性模式。然而，所有這些方法都設計為一次探索一個數據集。當分析師擁有多個數據集（或一個數據集中多個條件需要比較）時，目前的做法是對每個數據集分別執行PCA（或t-SNE、MDS等），然後手動比較各種投影，以探索數據集之間是否存在有趣的相似性和差異,。對比主成分分析（cPCA）旨在填補數據探索和可視化中的這一空白，通過自動識別在數據集之間顯示最有趣差異的投影。圖[1]提供了cPCA的概述，我們將在後面更詳細地解釋。

cPCA受到跨學科廣泛問題的驅動。為了說明，我們在此提到兩個這樣的問題，並在本文後面的實驗中展示其他問題。首先，考慮一個來自不同種族和性別個體的基因表達測量數據集。這些數據包括癌症患者的基因表達水平{x i}，我們有興趣分析這些數據。我們還有對照數據，對應於來自相似人口背景的健康患者的基因表達水平{y i}。我們的目標是找到癌症患者內的趨勢和變異（例如，識別癌症的分子亞型）。然而，如果我們直接對{x i}應用PCA，則頂部的主成分可能對應於個體的人口變異，而不是癌症的亞型，因為前者的遺傳變異可能比後者更大 。我們通過注意到健康患者也包含與人口差異相關的變異，但不包含與癌症亞型相關的變異來解決這個問題。因此，我們可以尋找{x i}具有高變異而{y i}具有低變異的成分。

作為一個相關的例子，考慮一個數據集{x i}，它由複雜背景上的手寫數字組成，例如不同的草地圖像（見Fig.[2(a), top]）。典型的無監督學習任務的目標可能是對數據進行聚類，揭示圖像中的不同數字。然而，如果我們對這些圖像應用標準PCA，我們會發現頂部的主成分不代表與手寫數字相關的特徵，而是反映了與圖像背景相關的特徵的主要變異（Fig.[2(b)], top）。我們展示了可以通過使用一個僅由草地圖像組成的參考數據集{y i}來糾正這一點（不一定是用於{x i}的相同圖像，但具有相似的特徵協方差，如Fig.[2(a)], bottom所示），並尋找{x i}相比於{y i}具有更高變異的子空間。通過投影到這個子空間，我們實際上可以根據手寫數字的值在視覺上分離圖像（Fig. 2(b), bottom）。通過比較PCA發現的主成分與cPCA發現的主成分，我們看到cPCA識別出更相關的特徵（Fig.[2(c)]），這使我們能夠將cPCA用於特徵選擇和去噪等應用 。

對比主成分分析是一種無監督學習工具，可以有效地降低維度以實現可視化和探索性數據分析。這將cPCA與一大類監督學習方法區分開來，這些方法的主要目標是對各種數據集進行分類或區分，例如線性判別分析（LDA）、二次判別分析（QDA）、監督PCA和QUADRO 。這也將cPCA與整合多個數據集的方法區分開來，這些方法的目標是識別兩個或多個數據集之間的相關模式，而不是每個單獨數據集特有的模式。除了PCA之外，還有豐富的無監督降維方法。例如，多維尺度分析（MDS）找到一個低維嵌入，保留高維空間中的距離；主成分追求找到一個對小的逐項噪聲和大稀疏錯誤具有魯棒性的低秩子空間。但沒有一個是設計用來利用第二個數據集中的相關信息的，正如cPCA所做的那樣。在補充材料中，我們將cPCA與許多先前提到的技術在代表性數據集上進行了比較（見補充圖[3]和[4]）, , ,。

在特定的應用領域中，可能存在具有與cPCA相似目標的專門工具, ,。例如，在結果中，我們展示了cPCA應用於基因型數據如何可視化墨西哥內的地理祖先。探索遺傳祖先的細粒度聚類是人口遺傳學中的一個重要問題，研究人員最近開發了一種算法，專門用於可視化這樣的祖先聚類 。雖然cPCA在這裡表現良好，但專家設計的算法可能對於特定數據集表現得更好。然而，專門的算法需要大量的領域知識來設計，計算成本更高，並且可能難以使用。cPCA的目標不是取代這些專門的最先進方法，而是提供一種探索任意數據集的通用方法。

我們在本文中提出了一個具體且高效的cPCA算法。該方法以我們感興趣的目標數據集{x i}作為輸入。作為次要輸入，cPCA接受一個背景數據集{y i}，其中不包含感興趣的模式。cPCA算法返回的子空間在目標數據{x i}中捕捉到大量變異，而在背景{y i}中則很少（見Fig.[1]，方法和補充方法了解更多細節）。這個子空間對應於包含{x i}特有結構的特徵。因此，當目標數據投影到這個子空間時，我們能夠相對於背景可視化並發現目標數據中的附加結構。類似於主成分（PCs），我們稱cPCA找到的方向為對比主成分（cPCs）。我們強調cPCA本質上是一種無監督技術，旨在通過使用背景數據集作為對比來更清晰地解析一個數據集中的模式。特別是，cPCA不尋求區分目標和背景數據集；包含在目標數據集中增強趨勢的子空間不一定是數據集之間分類的最佳子空間。

研究人員指出，標準PCA通常無法有效地發現生物數據中的子群，至少部分原因是“主要主成分……與偽影相關”，而不是與研究人員感興趣的特徵相關。cPCA如何在這些設置中用於檢測更重要的子群？通過使用背景數據集來消除目標中的普遍但不感興趣的變異，我們可以尋找目標數據集特有的結構 。

我們的第一個實驗使用了一個由接受過電擊療法的小鼠的蛋白質表達測量組成的數據集,。其中一些小鼠患有唐氏綜合症（DS）。為了創建一個無監督學習任務，我們假設分析師不知道這些DS信息，僅用於算法評估。我們希望看到是否能以無監督的方式檢測到受電擊小鼠群體中的任何顯著差異（唐氏綜合症的存在或不存在是一個關鍵例子）。在Fig. [3a] （上）中，我們展示了將PCA應用於目標數據集的結果：轉換後的數據未顯示小鼠群體內的任何顯著聚類。小鼠內的主要變異來源可能是自然的，例如性別或年齡。

我們將cPCA應用於這個數據集，使用一組未接受電擊療法的小鼠的蛋白質表達測量作為背景。它們是對照小鼠，可能具有與實驗小鼠相似的自然變異，但沒有因電擊療法而產生的差異。以此數據集作為背景，cPCA能夠在轉換後的目標數據中解析出兩個不同的群體，一個對應於沒有唐氏綜合症的小鼠，另一個（主要）對應於有唐氏綜合症的小鼠，如Fig. [3a] （下）所示。作為比較，我們還應用了其他8種降維技術來識別區分目標和背景數據集的方向，沒有一種能像cPCA那樣有效地分離小鼠（詳情見補充圖 [4] ）。

接下來，我們分析了一個更高維度的公共數據集，該數據集由來自白血病患者的骨髓單核細胞（BMMCs）的單細胞RNA表達水平組成，這些細胞在幹細胞移植前和移植後取自同一患者 。所有單細胞RNA-Seq數據都使用作者描述的類似方法進行預處理。特別是，在應用PCA或cPCA之前，所有數據集都被減少到500個基因，這些基因是根據目標數據中最高的離散度[方差除以均值]選擇的。同樣，我們執行PCA以查看是否可以在轉換後的數據中直觀地發現這兩個樣本。如Fig. [3b] （左上）所示，兩種細胞類型在由前兩個PCs跨越的空間中遵循相似的分佈。這可能是因為樣本之間的差異很小，PCs反映了每個樣本中各種細胞類型的異質性，甚至是實驗條件的變化，這可能對單細胞RNA-Seq測量有顯著影響 。

我們使用來自健康個體的BMMC細胞的RNA-Seq測量作為背景數據集來應用cPCA。我們預期這個背景數據集包含由於細胞群體的異質性以及實驗條件變化所引起的變異。因此，我們希望cPCA能夠恢復在目標數據中富集的方向，對應於移植前後的差異。確實，我們發現了這一點，如Fig. [3b] （左下）所示。

我們進一步增強了我們的目標數據集，加入了來自第二位白血病患者的BMMC樣本，同樣是在幹細胞移植前後。因此，總共有四個細胞亞群。對這些數據應用PCA顯示，這四個亞群在由前兩個主成分（PCs）所跨越的子空間中是不可分的，如Fig. [3b] （右上）所示。然而，當使用相同的背景數據集應用cPCA時，至少有三個亞群顯示出更強的分離，如Fig. [3b] （右下）所示。cPCA嵌入還表明，兩位患者的細胞樣本在幹細胞移植後（青色和綠色點）比移植前（金色和粉紅色點）更相似，這是一個可以由研究者測試的合理假設。可以參考補充Fig. [5] 以獲取更多有關此實驗的細節。我們看到cPCA可以是一個有用的工具來推斷亞群之間的關係，這是我們接下來要進一步探討的主題。

在之前的例子中，我們看到cPCA允許用戶發現目標數據集中未事先標記的子類。然而，即使子類在事先已知的情況下，降維也可以是一種有用的方法來可視化群體內的關係。例如，PCA經常被用來基於遺傳變異可視化種族群體之間的關係，因為將遺傳變異投影到兩個維度上通常會產生提供地理和歷史趨勢的驚人可視化圖,。但同樣，PCA僅限於識別最主要的結構；當這代表普遍或不感興趣的變異時，cPCA可以更有效地可視化趨勢。

我們用於此示例的數據集由來自墨西哥五個州的個體基因組中的單核苷酸多態性（SNPs）組成，這些數據是在先前的研究中收集的 。使用PCA分析墨西哥的祖先是具有挑戰性的，因為PCs通常不反映墨西哥內的地理起源；相反，它們反映了每個墨西哥個體的歐洲/美洲原住民遺產比例，這主導並掩蓋了由於墨西哥內地理起源引起的差異（見Fig. [4a] ）。為了解決這個問題，人口遺傳學家手動修剪SNPs，去除那些已知來自歐洲祖先的SNPs，然後應用PCA。然而，這種程序的適用性有限，因為它需要知道SNPs的來源，並且背景變異的來源與感興趣的變異非常不同，這通常不是情況。

作為替代方案，我們使用cPCA，背景數據集由來自墨西哥和歐洲的個體組成。這個背景由美洲原住民/歐洲變異主導，允許我們在目標數據集中隔離墨西哥內部的變異。應用cPCA的結果如Fig. [4b] 所示。我們發現來自墨西哥同一州的個體嵌入得更接近。此外，差異最大的兩組是索諾拉人和來自尤卡坦的瑪雅人，這也是墨西哥內地理上最遙遠的，而來自其他三個州的墨西哥人彼此接近，無論是在地理上還是在cPCA捕獲的嵌入中（見Fig. [4c] ）。另見補充Fig. [6] 以獲取更多細節。

在許多數據科學設置中，我們感興趣的是可視化和探索相對於其他數據在一個數據集中富集的模式。我們已經提出cPCA作為執行此類對比探索的一般工具，並在多種應用中展示了其用處。cPCA的主要優勢在於其通用性和易用性。計算特定的cPCA所需的時間基本上與計算常規PCA所需的時間相同。這種計算效率使cPCA對於交互式數據探索非常有用，其中每個操作理想情況下應該是幾乎即時的。因此，在任何應用PCA於相關數據集的設置中，cPCA也可以應用。在補充說明[3]和補充Fig.[8]中，我們展示了如何將cPCA核化以揭示數據集中的非線性對比模式。

對比PCA的唯一自由參數是對比強度α 。在我們的默認算法中，我們開發了一種基於子空間聚類的自動方案來選擇最具信息量的α 值（見方法）。本文進行的所有實驗都使用自動生成的α 值，我們相信這個默認值在cPCA的許多應用中是足夠的。如果需要更細緻的探索，用戶也可以輸入特定的α 值。

cPCA與常規PCA和其他降維方法一樣，不提供p 值或其他統計顯著性量化。通過cPCA發現的模式需要通過假設檢驗或使用相關領域知識的額外分析來驗證。我們已經將cPCA的代碼作為Python包發布，並附有文檔和示例。

對於d 維的目標數據xi ∈ Rd 和背景數據yi ∈ Rd ，令C X,C Y為其相應的經驗協方差矩陣。令R unit d = def v ∈ Rd :v2 = 1 為單位向量的集合。對於任何方向v ∈ R unit d ，它在目標數據和背景數據中所佔的方差可以寫為： Target data variance :λX ( v ) =defvTCXv , Background data variance :λY ( v ) =defvTCYv.給定一個對比參數α ≥ 0，量化了高目標方差和低背景方差之間的權衡，cPCA通過優化計算對比方向v * 1 v * = argmax v ∈ Runitd λ X(v)- α λ Y(v).  這個問題可以重寫為v * = argmax v ∈ Runitd v T CX - α CY v ,  這意味著v *對應於矩陣C = def CX - α CY 的第一個特徵向量。因此，可以使用特徵值分解有效地計算對比方向。類似於PCA，我們稱C 的主特徵向量為對比主成分（cPCs）。我們注意到cPCs是矩陣C 的特徵向量，因此彼此正交。對於固定的α ，我們計算( [1] )並返回由前幾個（通常是兩個）cPCs所跨越的子空間。

對比參數α 表示高目標方差和低背景方差之間的權衡。當α = 0時，cPCA選擇僅最大化目標方差的方向，因此簡化為應用於目標數據{x i}的PCA。隨著α 的增加，具有較小背景方差的方向變得更重要，cPCs被驅動到背景數據{y i}的零空間。在極限情況下α = ∞，任何不在{y i}零空間中的方向都會受到無限懲罰。在這種情況下，cPCA對應於首先將目標數據投影到背景數據的零空間，然後對投影數據進行PCA。

與其選擇單一的α 並返回其子空間，cPCA計算一系列α 的子空間，並返回在主角度上相距較遠的幾個子空間 。將數據投影到這些子空間上將揭示目標數據中的不同趨勢，通過視覺檢查返回的散點圖，用戶可以快速辨別出對其分析最相關的子空間（及相應的α 值）。詳情請參見補充圖 [1] 。

cPCA的完整算法在算法2（補充方法）中描述。我們通常將α 的潛在值列表設置為0.1到1000之間的40個對數間隔的值，這適用於本文中的所有實驗。為了選擇代表性子空間，cPCA使用譜聚類來聚類子空間，其中親和度定義為子空間之間主角度的餘弦的乘積。然後，每個聚類的中位數（代表）用作α 的值來生成用戶看到的散點圖 。

背景數據集的選擇對cPCA的結果有很大影響。一般來說，背景數據應具有我們希望從目標數據中去除的結構。這種結構通常對應於目標中具有高方差的方向，但對分析者來說並不感興趣。

我們提供了一些可能為目標數據提供有用對比的背景數據集的一般示例：（1）對照組{y i}與患病人群{x i}對比，因為對照組包含類似的人口水平變異，但不包含由於疾病不同亞型引起的微妙變異。（2）用時間零點的數據{y i}對比後來時間點的數據{x i}。這使得能夠可視化時間上最顯著的變化。（3）均質組{y i}與混合組{x i}對比，因為兩者都有群內變異和測量噪聲，但前者沒有群間變異。（4）用治療前數據集{y i}對比治療後數據{x i}以去除測量噪聲但保留由治療引起的變異。（5）一組無信號的記錄{y i}或僅包含噪聲的圖像，與包含信號和噪聲的測量{x i}對比。

值得一提的是，背景數據不需要與我們希望從目標數據集中去除的協方差結構完全相同。例如，在Fig. [2] 所示的實驗中，事實證明我們不需要使用由草地圖像組成的背景數據集。實際上，即使使用天空圖像作為背景數據集，也能獲得類似的結果。由於協方差矩陣的結構足夠相似，cPCA從目標數據中去除了背景結構。此外，cPCA不要求目標數據和背景數據具有相似的樣本數。由於協方差矩陣是獨立計算的，cPCA只要求經驗協方差矩陣是基礎人口協方差矩陣的良好估計，這與PCA的要求基本相同。

在此，我們討論cPCA的幾何解釋及其統計特性。首先，考慮哪些方向對比分析更“好”是很有趣的。對於一個方向v ∈ R unit d ，其在cPCA中的重要性完全由其目標-背景方差對(λ X(v ),λ Y(v ))決定；理想情況下，目標方差應更高而背景方差應更低。基於這一直覺，我們可以進一步定義各種方向的對比性部分順序：對於兩個方向v1 和v2 ，如果v1 具有更高的目標方差和更低的背景方差，我們可以說v1 是一個更好的對比方向。在這種情況下，v1 的目標-背景方差對將位於v2 的右下方，如目標-背景方差對的圖中所示(λ X(v ),λ Y(v ))，例如Fig. [5] 。基於這一部分順序，最具對比性的方向集可以類似於帕累托前沿的定義 。令U  為所有方向的目標-背景方差對的集合，即U = def  ( λX ( v ) ,λY ( v ))  v ∈ Runitd 。最具對比性的方向集對應於目標-背景方差對圖中的U  的右下邊界，如Fig. [5] 所示。（對於同時可對角化的背景和目標矩陣的特殊情況，請參見補充圖 [7] 。）

關於cPCA，我們可以證明（見補充說明 [2] ）通過改變α ，頂部cPC的集合與最具對比性的方向集相同。此外，對於cPCA選擇的方向v ，其對比參數設置為α ，其方差對(λ X(v ),λ Y(v ))對應於U  的右下邊界與斜率為1/α 的切線的切點。因此，通過將α 從零變化到無窮大，cPCA選擇的方向方差對從U  的右下邊界的左下端移動到右上端 。

我們還指出，關於數據的隨機性，樣本cPC到群體cPC的收斂速度為O p  dmin ( n,m ) ，在溫和的假設下，其中d 是維度，n 和m 是目標和背景數據的大小。這一速度類似於協方差矩陣樣本特徵向量的標準收斂速度。詳情請參見補充說明 [2] 。

我們已在GitHub上發布了對比PCA的Python實現（https://github.com/abidlabs/contrastive ）。GitHub存儲庫還包括Python筆記本和數據集，這些筆記本和數據集重現了本文和補充信息中的大多數圖形。

本文中用於評估對比PCA的數據集可從我們或原始研究的作者處獲得。請參見上一節中列出的GitHub存儲庫以獲取我們已發布的數據集。

Fig. 1: cPCA 的示意圖概述。為了執行 cPCA，計算目標和背景數據集的協方差矩陣 C X, C Y。協方差矩陣加權差的奇異向量 C X− α · C Y，是 cPCA 返回的方向。如右側散點圖所示，PCA（在目標數據上）識別出目標數據中方差最大的方向，而 cPCA 識別出目標數據中相較於背景數據方差更大的方向。將目標數據投影到後者的方向上，會顯示出目標數據特有的模式，並且通常揭示出 PCA 所忽略的結構。具體來說，在此示例中，通過 cPCA 降低目標數據的維度將揭示出兩個不同的聚類

Fig. 2: 對噪聲數字進行對比主成分分析。a, 上：我們通過隨機將 MNIST 數據集 中的手寫數字 0 和 1 的圖像疊加在來自 ImageNet 數據集 的草地圖像上，創建了一個包含 5,000 個合成圖像的目標數據集。草地圖像被轉換為灰度，調整大小為 100 × 100，然後隨機裁剪為與 MNIST 數字相同的大小，28 × 28。b, 上：在此，我們繪製了使用標準 PCA 將合成圖像嵌入到其前兩個主成分的結果。我們看到對應於 0 的圖像和 1 的圖像的點難以區分。a, 下：然後引入一個背景數據集，僅包含屬於相同同義詞集的草地圖像，但我們使用的圖像與創建目標數據集所用的圖像不同。b, 下：使用 cPCA 在目標和背景數據集上（對比參數 α 設置為 2.0），在目標數據集的低維表示中出現了兩個聚類，一個由數字 0 的圖像組成，另一個由數字 1 的圖像組成。c我們查看每個像素對第一主成分（PC）和第一對比主成分（cPC）的相對貢獻。較白的像素是那些具有更正權重的像素，而較暗的像素則表示具有負權重的像素。PCA 傾向於強調圖像邊緣的像素，並略微減少圖像中心和底部的像素，這表明大多數方差是由背景特徵引起的。另一方面，cPCA 傾向於增加手寫 1 的位置的像素權重，減少手寫 0 的位置的像素權重，並忽略大多數其他像素，有效地發現那些有助於區分疊加數字的特徵

Fig. 3: 在生物數據中發現子群。 a 我們使用 PCA 將患有和不患有唐氏綜合症（DS）的老鼠的蛋白質表達數據集投影到前兩個成分上。患有和不患有 DS 的老鼠的蛋白質表達測量的低維表示被認為是相似地分佈的（上）。但是，當我們使用 cPCA 將數據集投影到其前兩個 cPC 上時，我們發現了一個低維表示，將患有和不患有 DS 的老鼠分開聚類（下）。 b 此外，我們使用 PCA 和 cPCA 將高維單細胞 RNA-Seq 數據集可視化為兩個維度。該數據集由來自兩名白血病患者的四個細胞樣本組成：患者 1 的移植前樣本，患者 1 的移植後樣本，患者 2 的移植前樣本，患者 2 的移植後樣本。 b , 左：僅使用患者 1 的樣本的結果，顯示 cPCA（下）比 PCA（上）更有效地分離樣本。當包括第二名患者的樣本時，在 b , 右，再次顯示 cPCA（下）比 PCA（上）更有效地分離樣本，儘管兩名患者的移植後細胞分佈相似。我們在補充圖[5] 中分別顯示了每個樣本的圖，其中更容易看到不同樣本之間的重疊

Fig. 4: 墨西哥祖先群體之間的關係。 a 將 PCA 應用於來自 5 個墨西哥州的個體的遺傳數據，未能在嵌入數據中揭示任何可視的模式。 b 將 cPCA 應用於相同的數據集揭示了數據中的模式：來自同一州的個體在 cPCA 嵌入中聚集得更近。 c 此外，點的分佈揭示了群體之間的關係，這與不同州的地理位置相匹配：例如，來自地理上相鄰州的個體在嵌入中也是相鄰的。 c 改編自墨西哥地圖，原始作品由 Wikipedia 的用戶 Allstrak 創作，根據 CC-BY-SA 授權發佈，來源於 https://commons.wikimedia.org/wiki/File:Mexico_Map.svg

Fig. 5: cPCA 的幾何解釋。目標-背景方差對的集合U被繪製為一些隨機生成的目標和背景數據的青色區域。右下邊界，顏色為金色，對應於最具對比性的方向集合Sλ。藍色三角形是對比主成分（cPCs）的方差對，分別選擇 α 值為 0.92 和 0.29。我們注意到它們對應於金色曲線的切點和斜率為1α= 1.08, 3.37，分別

