Physics-informed neural network for lithium-ion battery degradation stable modeling and prognosis

Abstract: 准确的状态健康度（SOH）估计对于锂离子电池的可靠和安全运行至关重要。然而，由于电池类型和运行条件的多样性，可靠的电池SOH估计仍然具有挑战性。在本文中，我们提出了一种物理信息神经网络（PINN），用于准确和稳定的电池SOH估计。具体来说，我们从经验退化和状态空间方程的角度建模影响电池退化的属性，并利用神经网络捕捉电池退化动态。设计了一种通用特征提取方法，从电池完全充电前的短时间段数据中提取统计特征，使我们的方法适用于不同类型的电池和充放电协议。此外，我们生成了一个包含55个锂镍钴锰氧化物（NCM）电池的综合数据集。结合来自不同制造商的其他三个数据集，我们使用总共387个电池和310,705个样本验证了我们的方法。平均绝对百分比误差（MAPE）为0.87%。与替代神经网络相比，我们提出的PINN在常规实验、小样本实验和迁移实验中表现出显著的性能。本研究突显了物理信息机器学习在电池退化建模和SOH估计中的潜力。

近年来，锂离子电池在全社会的数量以惊人的速度增长，这为可再生能源设备的普及提供了前所未有的推动力。凭借高能量密度、低自放电率和长使用寿命等优点，锂离子电池已成为便携式电子设备、电动汽车、航空航天等众多领域的主要储能装置, , , , , ,。2019年，仅新能源汽车用锂离子电池的全球出货量就达到了116.6 GWh 。据估计，到2025年，全球锂离子电池的装机容量将达到800 GWh，市场价值将达到91.8亿美元 。锂离子电池的爆炸性增长为人们的生活带来了便利，但其老化和健康管理也引起了人们的关注。锂离子电池的老化是一个重要问题，其性能会随着时间的推移而下降，直至失效。为了确保长期、安全和持续的运行，锂离子电池必须得到适当的维护和控制，这包括状态健康度（SOH）评估。电池的SOH定义为当前可用容量与初始容量的比值，可以作为衡量电池退化的指标 。当SOH降至80%时，电池达到其首次使用寿命。达到首次使用寿命的电池仍可在储能电站等领域进行二次利用。因此，准确估计电池的SOH尤为重要。

近年来，提出了各种锂离子电池的SOH估计方法，极大地推动了该领域的发展, , ,。然而，准确估计SOH仍然是一个具有挑战性的问题。通常，容量可以通过从上限截止电压到下限截止电压的完整放电曲线通过安时积分获得，从而获得SOH。在实际应用中，由于电池很少完全放电，因此很难获得完整的充电或放电曲线。一些学者通过建立电池老化模型来估计SOH。Baghdadi等人提出了一种基于Dakin退化方法的物理方法，用于模拟电池的线性退化过程。考虑到时变温度条件对锂离子电池放电容量和老化规律的重要影响，Xu等人基于Arrhenius温度模型提出了一个随机退化率模型，并基于Wiener过程建立了锂离子电池在时变温度条件下的老化模型。Dong等人提出了一种结合化学和机械退化机制的物理模型，通过模拟固体电解质界面（SEI）的形成和生长来预测容量衰减。Lui等人通过建模正负极活性材料损失和锂库存损失等退化机制，提出了一种物理方法来预测锂离子电池的容量 。

鉴于建立物理模型的难度和获得完整放电容量的困难，许多研究使用了数据驱动的方法，基于充放电过程中的电流和电压曲线来估计SOH。常用的数据驱动方法包括线性回归、支持向量机、高斯过程回归、深度神经网络等。Xia等人从增量容量（IC）曲线和差分电压（DV）曲线中提取特征来估计SOH。Wang等人从电化学阻抗谱（EIS）中提取有价值的健康指标作为高斯过程回归的输入来估计SOH。数据驱动方法不需要物理知识，只关注输入和输出之间的关系，因此退化特征的提取是数据驱动方法的关键部分，很大程度上决定了SOH估计的性能, , , , ,。





在本研究中，我们提出了一种用于电池SOH估计的PINN，属于B2架构。该方法实现了控制方程和神经网络的真正集成，从而实现稳定和精确的SOH估计。与现有的PINN方法不同，我们还验证了其在小样本学习和不同化学成分及充放电配置的电池之间的迁移学习中的优势。具体来说，首先，考虑到电化学方程的复杂性，阻碍了B2型PINN的发展。因此，我们从经验退化和状态空间方程的角度建模电池退化动态，并利用神经网络捕捉电池退化动态。其次，为了使模型更具通用性，我们开发了一种新的特征提取方法。电池的放电过程具有用户特定性，且电池很少完全放电。相比之下，一旦充电开始，完全充电的概率较高，且更加固定和规律。因此，我们从电池完全充电前的短时间段数据中提取特征。第三，为了验证我们的方法，我们进行了电池退化实验并发布了一个包含55个电池的运行至失效数据的数据集。此外，我们还在其他三个具有不同化学成分和充放电协议的大规模数据集上验证了我们的方法，证明了我们方法的优越性和通用性。我们还通过将退化知识从一个数据集转移到另一个数据集来进一步估计SOH。这些用于执行迁移任务的数据集包含具有不同化学成分和充放电协议的电池。结果表明，所提出的PINN在SOH估计中具有有效性和通用性。

我们开发了一种用于锂离子电池SOH估计的PINN，其流程图如图 Fig. [1] 所示。我们的方法通过考虑电池退化的动态行为和退化趋势，旨在实现更通用、可靠、稳定和高精度的SOH估计。

在数据预处理阶段（如图 Fig. [1] b 所示），从电池完全充电前的短时间段数据中提取统计特征作为模型的输入，这确保了这一时间段的数据存在于大多数电池数据集中，解决了现有研究中特征不通用的问题。因此，我们的方法适用于具有不同化学成分和充放电协议的电池。





为了涵盖不同类型的电池和化学成分，我们使用了来自4个不同大规模数据集的387个电池的310,705个样本进行验证。第一个数据集来自我们为本研究进行的电池退化实验，其他三个数据集是来自Zhu等人、Ye等人和Severson等人的知名公共数据集 。为了方便起见，我们将这四个数据集分别称为XJTU电池数据集、TJU数据集、HUST数据集和MIT数据集 。四个数据集的基本信息见表 [1] 。

在本研究中，我们开发了一个电池退化实验，如图 [S1] 所示。总共55个由LISHEN制造的电池（LiNi0.5 Co0.2 Mn0.3 O2 ，标称容量2000 mAh，标称电压3.6 V，充电和放电截止电压分别为4.2 V和2.5 V）在室温下按照6种充放电协议循环至失效。这些协议包括固定充放电、不同循环中的固定电流随机放电、随机行走，以及地球同步轨道（GEO）卫星的充放电策略。我们用批次1到批次6分别表示这6种充放电协议。退化轨迹如图 [2] 所示。关于我们的数据集的更多详细信息可以在补充说明 [1] 中找到。

TJU数据集包含三种类型的电池：NCA电池（标称容量3500 mAh，截止电压2.65–4.2 V），NCM电池（标称容量3500 mAh，截止电压2.5–4.2 V），以及NCM + NCA电池（标称容量2500 mAh，截止电压2.5–4.2 V）。这些电池在温度控制室中以不同的温度和不同的充电电流率循环。温度候选集包括25、35和45 °C。电流率范围从0.25 C到4 C。我们用批次1、批次2和批次3分别表示NCA、NCM和NCM + NCA电池。

HUST数据集包含77个LFP/石墨电池在77种不同的多阶段放电协议下的数据。这些电池由A123（APR18650M1A）制造，标称容量为1100 mAh，标称电压为3.3 V。它们在30 °C的温度下以相同的充电协议但不同的放电协议循环至失效。

MIT数据集中的电池与HUST数据集中的电池类型和化学成分相同。然而，与HUST数据集的实验设置不同，MIT数据集考虑了多种快速充电策略和一种放电策略。具体来说，它们在快速充电实验中以一步或两步快速充电策略循环，并以4 C的电流放电。实验温度为30 °C。

稳健的特征通常可以提高SOH估计的性能。然而，如何提取通用且稳健的特征是一个值得研究的问题。在现有的研究中，提出了针对特定数据集和充放电协议的各种特征提取方法，但特征的泛化性尚未得到充分考虑。关于不同电池类型或充放电协议的通用特征提取方法的研究较少。为了提取更稳健和通用的特征，我们提出了一种方法，通过观察和探索多个数据集，从充电电压曲线和电流曲线的短时间段中提取特征。电池的放电过程具有用户特定性。相比之下，充电过程是必要的，更加固定和规律，且电池完全充电的概率相对较高。我们发现，大多数数据集包含恒流和恒压（CC-CV）充电模式。对于我们使用的四个公共数据集，无论电池采用何种放电策略或是否完全放电，最终都会在充电时完全充满。

因此，我们选择了电池完全充电前的短时间段数据来提取特征，如图 [1] b所示。定义电池的充电截止电压为Vend ，选择电压值在[Vend−0.2 ,Vend ] V范围内的电压数据。对于电流数据，我们选择恒压充电期间电流在0.5 A和0.1 A之间的数据。无论电池是否完全放电，只要电池完全充电，电压范围和电流范围总是存在的。

从选定的电流和电压曲线中分别提取均值、标准差、峰度、偏度、充电时间、累积充电量、曲线斜率和曲线熵（这些特征分别编号为1–16。更多详细信息见补充说明 [2] ）。从XJTU数据集的第1批中提取的特征示例如图 [3] a所示。进一步，我们从4个数据集中的387个电池中分别提取特征，并计算每个数据集中特征与SOH之间的皮尔逊相关系数，如图 [3] b所示。

基于图 [3] b的实验现象和分析，我们提出一个自然的猜想：每个特征与SOH之间的相关系数的大小与电池的化学成分有关，而受充放电协议的影响较小。据我们所知，我们是第一个关注这一现象的研究。从表 [1] 可以看出，XJTU数据集和TJU数据集都是LiNiCo-x型电池。尽管它们的标称容量和充放电协议完全不同，但从我们选择的范围内提取的特征高度相似。例如，特征11–16与SOH之间存在非常强的负相关。特征9和10与SOH之间存在强正相关。相比之下，MIT数据集和HUST数据集都是LiFePO4 电池。特征11–16与SOH之间存在弱正相关，而特征9和10与SOH之间存在负相关。此外，后两个数据集的特征3–6和8与SOH之间存在强正相关。

提取的16个特征和时间（循环）作为所提出的PINN的输入来估计SOH。为了减少特征量级差异对模型的影响并使模型训练更加稳定，对特征进行了最小-最大归一化。即，所有特征都被缩放到[−1,1]范围内。所提出的PINN在4个数据集上的SOH估计结果如图 [4] a所示（每个数据集的测试电池数量见补充说明 [S2] ）。

为了展示所提出的PINN的先进性，使用了具有相同结构和参数量的多层感知器（MLP）和具有相似参数量的卷积神经网络（CNN）作为比较方法。MLP和CNN的详细信息可以在补充说明 [3] 中找到。对于每个数据集，我们将训练电池、验证电池和测试电池大致按6:2:2的比例划分。每个数据集的测试电池数量可以在表 [S2] 中找到。为了确保公平性，测试电池的数量在整个数据集中均匀分布，如表 [S3] – [S6] 所示。3个模型在4个数据集上的结果如表 [2] 所示（仅给出每个数据集的平均测试误差，每个电池的测试结果可以在表 [S3] – [S6] 中查看）。从表中可以看出，我们的方法在大多数情况下具有最小的估计误差。所提出的PINN在4个数据集上的平均MAPE分别为0.85%、1.21%、0.65%和0.78%，而MLP的平均MAPE分别为2.60%、1.72%、0.83%和0.83%。值得注意的是，它们在推理过程中具有相同的参数数量和模型结构。

此外，为了反映模型的稳定性，每个模型在每个数据集上的训练和测试过程重复10次。测试结果如图 [4] b所示。从图中可以看出，我们提出的PINN在所有任务和所有指标上都是最稳定的。XJTU电池数据集的每个批次的样本量较小，导致MLP和CNN的波动较大。相比之下，我们的方法更加稳定，测试误差更小。对于HUST数据集和MIT数据集，它们包含大量的训练样本，因此MLP和CNN的波动变小，测试误差也变小。然而，我们提出的PINN仍然是表现最好的模型。

我们提出的PINN模型考虑了更多的物理定律，因此可以用更少的数据进行训练。与纯数据驱动方法相比，当可用训练数据量较小时，我们的方法可以表现出更大的优势。为了验证上述推论，我们在XJTU数据集和HUST数据集上进行了小样本实验。

具体来说，我们使用1个电池的数据训练3个模型，并在多个电池上进行测试（测试集与2.4节相同），并记录测试结果。此外，我们逐渐增加训练电池的数量，并观察每个模型在测试集上的性能变化。结果如表 [3] 和图 [5] 所示（仅给出XJTU数据集的批次1结果，更多结果可以在表 [S7] 和图 [S5] 中找到）。

可以观察到，我们提出的PINN在所有任务和设置中都取得了最佳结果。随着训练电池数量的增加，3个模型的测试误差都减小。这是一个普遍接受的事实：当训练数据较少时，增加训练样本的数量可以提高模型的性能。在图 [4] b中，由于HUST数据集的样本量较大，CNN和MLP的性能与我们的PINN相当。这也说明了当模型的结构或参数数量相同或相似时，只要有足够的训练样本，模型的性能差异不大。然而，从图 [5] 可以看出，当训练样本数量较小时，我们的方法具有显著的优势。此外，值得注意的是，仅用1个电池训练的PINN的性能与用3-4个电池训练的MLP和CNN相当，这表明我们的PINN在小样本场景中具有优势。

微调是迁移学习的一种实现方式，通过使用少量新收集的数据快速调整模型来提高学习能力。其优势在于可以使用在其他场景（源域）中收集的大量数据来预训练模型并学习特征与标签之间的基本关系。然后使用少量目标域数据快速微调模型以获得良好的性能。现有的大多数关于SOH估计的迁移学习研究都是在不同的充放电协议之间进行的，而关于不同数据集（不同化学成分）之间的迁移研究较少。在本文中，我们将4个数据集配对进行微调实验。

我们认为退化动态G(⋅)独立于充放电协议和数据集，而解F(⋅)与它们相关。在从大量数据中学习后，G(⋅)应包含可以反映电池退化本质的一般信息，这对于跨场景的SOH估计是有用的。因此，我们仅微调解F(⋅)的权重，并冻结动态G(⋅)的权重，如图 Fig. 6b 所示。







为了验证我们的方法，我们进行了电池老化实验并开发了一个包含55个电池的数据集。最后，我们在4个大规模数据集中验证了我们的方法，这些数据集包含387个具有不同化学成分和充放电协议的电池。结果证明了我们提出的方法的有效性和可行性。此外，我们进行了小样本实验和迁移实验，证明了考虑物理知识有助于数据驱动模型更快、更好地从数据中学习。我们的研究突显了物理信息机器学习在电池退化建模和SOH估计中的潜力。它可以通过使用现有的实验数据和少量新数据，促进下一代电池管理系统的快速发展。

电池退化建模和SOH估计是电池健康管理领域的研究热点。随着电池老化，各种界面退化过程发生，伴随着锂库存和活性材料的损失，导致离子和电子转移以及嵌入反应的电阻增加，从而导致充电曲线的变化 。因此，充电曲线包含丰富的退化过程信息。然而，使用充放电曲线来估计电池SOH可能会陷入信息泄露的陷阱。Geslin等人指出，不一致的充放电协议、使用条件等可能导致信息泄露，这是一个可能被学者忽视的严重问题。他们认为，固定的恒流-恒压（CC-CV）模式可以缓解信息泄露的问题。因此，在进行SOH估计任务时，应尽量避免纳入与电池内部质量、制造变异性及使用条件相关的因素。在我们的研究中，特征是从电池完全充电前的CC-CV阶段的一小段数据中提取的，这与电池使用条件无关。这确保了我们提取的特征的有用性和通用性，同时避免了由于不一致的充电协议或电池使用条件导致的信息泄露问题。在训练和测试阶段，我们使用电池A的数据训练模型，并在电池B上进行测试；而不是使用电池A的早期数据训练模型并在后期数据上进行测试，这避免了训练集向测试集的信息泄露 。

在构建SOH估计模型时，我们提出了一种用于电池SOH估计的PINN。物理信息神经网络作为一种有效的途径，有望利用人工智能解决实际工程问题。通过将传统的物理模型与神经网络模型结合，它可以更准确地捕捉电池系统的复杂动态行为，从而促进更可靠和精确的状态估计。然而，这一新兴领域仍需学者进一步探索。在Aykol等人提出的框架中，混合方法利用物理方程约束神经网络或将物理方程集成到神经网络中，将在长期内占据主导地位。这类混合方法有潜力将基于物理模型的因果关系和外推能力与神经网络的速度、灵活性和高维能力结合起来。然而，这些方法的局限性在于电池物理模型的复杂性（例如P2D模型），其中包含众多参数，且电池的内部参数难以收集。目前还没有令人满意的方法可以无缝集成物理模型和神经网络。本文提出的PINN从经验退化和状态空间方程的角度建模，仅作为这类混合方法的探索，并作为进一步研究的催化剂。此外，我们仅考虑从易于获取的电流和电压数据中提取特征。随着更多数据和内部变量的可用，可以考虑更复杂的电化学模型。在现有数据和计算资源的约束下，电池控制方程和神经网络的最优集成仍需进一步探索 。

电池老化主要表现为可用容量的减少和内部电阻的增加，通常遵循下降轨迹。为了准确描述电池退化轨迹，学者们提出了各种经验模型，描述电池容量随时间或循环次数的损失，包括线性模型、指数模型、幂律模型和失效预测模型（FFM）等。这些模型都将电池的退化轨迹描述为时间的单变量函数 。

然而，将电池退化轨迹仅表示为时间的单变量函数过于简化了这一过程。事实上，电池退化不仅与时间有关，还与充电率、放电率、日历时间、温度、放电深度（DOD）等有关。例如，Xu等人将电池老化分为日历老化和循环老化，考虑了荷电状态（SOC）、DOD、电池温度和固体电解质界面（SEI）膜生长等因素。他们将日历老化和循环老化建模为日历时间、SOC、DOD和温度的函数 。

因此，仅将电池退化轨迹建模为时间的函数是不充分的。在本研究中，我们提出将其建模为多变量函数： 1 u = f(t , x),  其中t 表示时间，x 表示由 SOC、DOD、温度、充电率、放电率、健康指标（HIs）和其他所有因素组成的向量。在我们的工作中，x 表示从充电数据中提取的 HIs（有关更多详细信息，请参见“特征提取”部分）。

为了描述电池的退化动态，其 SOH 衰减速率可以描述为： 2 ∂ u ∂ t = g t , x , u ; θ.  上述方程是一个由θ 参数化的显式偏微分方程（PDE），g ( ⋅ ) 表示t 、x 和u 的非线性函数。函数g ( ⋅ ) 描述了电池的内部退化动态，通过改变这个非线性函数，可以表示各种形式的退化。当仅考虑时间时，线性模型、指数模型、幂律模型和 FFM 可以视为方程 ( [2] ) 的特殊情况。









表1: 四个数据集的化学成分和基本实验条件
数据集 | 批次 | 化学成分 | 标称容量 (mAh) | 截止电压 (V) | 实验温度 (°C) | 电池数量
XJTU | 1,2,3,4,5,6 | LiNi 0.5Co 0.2Mn 0.3O 2| 2000 | 2.5–4.2 | 室温 | 55
TJU | 1 | Li 0.86Ni 0.86Co 0.11Al 0.03O 2| 3500 | 2.65–4.2 | 25,35,45 | 66
| 2 | Li 0.84Ni 0.83Co 0.11Mn 0.07O 2| 3500 | 2.5–4.2 | 25,35,45 | 55
| 3 | 42 (3) wt.% LiNiCoMnO 2和 58 (3) wt.% LiNiCoAlO 2的混合物 | 2500 | 2.5–4.2 | 25 | 9
MIT | – | LiFePO 4| 1100 | 2.0–3.6 | 30 | 125
HUST | – | LiFePO 4| 1100 | 2.0–3.6 | 30 | 77
充放电协议在不同数据集中有所不同。

表 3: 在XJTU数据集批次1和HUST数据集上的小样本实验结果
数据集 | 训练电池 | 我们的方法 | MLP | CNN | | | MAPE | RMSE | MAPE | RMSE | MAPE | RMSE
XJTU | 1 |  0.0141|  0.0184| 0.0343 | 0.0390 | 0.0929 | 0.0949
| 2 |  0.0105|  0.0134| 0.0267 | 0.0304 | 0.0728 | 0.0826
| 3 |  0.0069|  0.0096| 0.0347 | 0.0383 | 0.0548 | 0.0666
| 4 |  0.0056|  0.0076| 0.0292 | 0.0327 | 0.0560 | 0.0647
HUST | 1 |  0.0446|  0.0485| 0.0601 | 0.0682 | 0.3614 | 0.1550
| 2 |  0.0178|  0.0202| 0.0391 | 0.0461 | 0.0826 | 0.0925
| 3 |  0.0154|  0.0181| 0.0251 | 0.0287 | 0.0514 | 0.0618
| 4 |  0.0144|  0.0173| 0.0253 | 0.0288 | 0.0429 | 0.0521
MAPE 是平均绝对百分比误差，RMSE 是均方根误差。最佳结果以粗体显示。所有值均取自十次实验的平均值。"训练电池" 意味着我们分别使用 1、2、3 和 4 个电池来训练模型，然后在测试集上进行测试。

Fig. 1: a 锂离子电池可能具有不同的化学成分（例如，锂镍钴锰酸盐（NCM）、锂镍钴铝酸盐（NCA）和锂铁磷酸盐（LFP）等）。不同的用户具有个性化的电池放电策略，导致不同的退化轨迹。 b 用于特征提取的选定数据的示意图。我们从电池完全充电前的短时间段数据中提取特征。这些特征用作所提出的PINN的输入以估计SOH。上图是第10个循环的曲线，下图是整个生命周期中的所有曲线。电池老化和充放电协议的变化导致曲线偏移。 c 所提出的PINN的结构，其中 u 和û分别表示真实的和估计的SOH， t 和 x 分别表示循环和特征，上标 i 表示样本索引，下标 t 和 x 表示相应的偏导数。函数 f ( ⋅ ) 和 g ( ⋅ ) 分别建模特征到SOH的映射和电池的退化动态，F  ( ⋅ ) 和G  ( ⋅ ) 表示用于近似 f ( ⋅ ) 和 g ( ⋅ ) 的神经网络（更多详细信息见“方法”部分）。

Fig. 2: 总共有6个批次（55个电池），所有批次都包含8个电池，除了批次2包含15个电池。各批次的充放电协议不同。更多详细信息见补充说明[1] 。

Fig. 3: a XJTU数据集批次1中8个电池的特征。每个子图的 x -轴是SOH， y -轴是相应特征的归一化值。每个子图右侧的数字代表特征编号。 b 四个数据集中提取特征与SOH之间的相关性热图。数字1–16代表16个特征，特征的顺序与( a )中一致。

Fig. 4: a 所提出的PINN在四个数据集上的SOH估计结果。预测的和真实的SOH分布在对角线附近，表明模型表现良好。 b 三个模型（所提出的PINN（Ours）、多层感知器（MLP）和卷积神经网络（CNN））在四个数据集上的平均绝对误差（MAE）、平均绝对百分比误差（MAPE）和均方根误差（RMSE）的分布。每个误差条包含10个点（10次实验），并标记有均值和标准差线。与另外两种方法相比，我们的方法具有更小的预测误差且更加稳定。源数据作为源数据文件提供。

Fig. 5: 每个误差条包含10个点（10次实验），并标记有均值和标准差线。图例中的“1 battery”表示我们仅使用1个电池的数据来训练模型。其他情况类似。随着电池数量的增加，三种模型的性能逐渐提高。然而，我们的方法在其中仍然表现最佳。 a XJTU数据集批次1的结果。 b HUST数据集的结果。源数据作为源数据文件提供。

Fig. 6: a 提取的特征 x 和循环 t 用于估计SOH u 。û表示估计的SOH，下标 t 和 x 表示相应的偏导数。神经网络F  ( ⋅ ) 和G  ( ⋅ ) 分别用于建模特征到SOH的映射和电池退化动态。 b 当所提出的PINN应用于迁移学习场景时，动态G  ( ⋅ ) 被冻结，仅对解F  ( ⋅ ) 进行微调。

