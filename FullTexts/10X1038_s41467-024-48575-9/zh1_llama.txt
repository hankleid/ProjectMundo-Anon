零样本学习实现光学荧光显微镜的即时去噪和超分辨率

摘要: 计算超分辨率方法，包括传统的分析算法和深度学习模型，已经大大改进了光学显微镜。其中，监督深度神经网络已经展示了卓越的性能，但是需要大量高质量的训练数据，这些数据由于活细胞的高动态性而难以获取。这里，我们开发了零样本去卷积网络（ZS-DeconvNet），它可以即时提高显微镜图像的分辨率，超过衍射极限1.5倍，且比普通超分辨率成像条件的荧光强度低10倍，在无需地真实值或额外数据采集的情况下，以无监督的方式工作。我们展示了ZS-DeconvNet在多种成像模式下的多功能应用，包括全内反射荧光显微镜、三维宽场显微镜、共焦显微镜、两光子显微镜、格子光片显微镜和多模态结构照明显微镜，这使得从有丝分裂单细胞到小鼠和C. elegans 多细胞胚胎的亚细胞生物过程可以进行多色、长期、超分辨率2D/3D成像。

光学荧光显微镜是生物研究的必备工具。最近的超分辨率（SR）技术的发展为可视化多种生物过程的精细动态结构提供了前所未有的分辨率。然而，通过任何SR方法获得的空间分辨率提高都伴随着其他成像度量的权衡，例如持续时间或速度，这些对于解析生物过程同样重要。最近，计算SR方法因其能够在silico中即时提高图像分辨率而受到关注，从而显著升级现有的荧光显微镜系统并扩展其应用范围。计算SR方法可以分为两类：基于分析模型的方法，例如去卷积算法，以及基于深度学习的方法，例如SR神经网络。前者通常采用分析模型，假设标本和图像具有某些性质，例如稀疏性和局部对称性，以提高图像分辨率，并具有多个可调参数。参数调优依赖于经验且耗时，分析模型的输出极大地依赖于参数集。此外，在实际实验中，具有某些假设的手工模型无法解决显微镜成像的全部统计复杂性，因此缺乏鲁棒性，容易产生artifact，特别是在低信噪比（SNR）条件下。另一方面，基于深度学习的SR（DLSR）方法在学习端到端图像转换关系方面取得了惊人的成功，无需显式的分析模型。值得注意的是，通过深度学习的数据驱动逆算可以近似图像退化过程的伪逆函数以及SR解决方案的随机特性。然而，训练DLSR模型需要大量的配对低分辨率输入图像和高质量的ground truth（GT）SR图像，这在生物标本中由于快速动态或低荧光SNR而极其耗时，有时甚至不切实际。此外，DLSR方法的性能极大地依赖于训练数据的质量和数量。这些因素严重阻碍了DLSR方法在日常成像实验中的广泛应用，尽管其SR性能比基于分析模型的方法更具吸引力。

一般来说，现有的计算SR方法可以分为两类：基于分析模型的方法，例如去卷积算法，以及基于深度学习的方法，例如SR神经网络。前者通常采用分析模型，假设标本和图像具有某些性质，例如稀疏性和局部对称性，以提高图像分辨率，并具有多个可调参数。参数调优依赖于经验且耗时，分析模型的输出极大地依赖于参数集。此外，在实际实验中，具有某些假设的手工模型无法解决显微镜成像的全部统计复杂性，因此缺乏鲁棒性，容易产生artifact，特别是在低信噪比（SNR）条件下。另一方面，基于深度学习的SR（DLSR）方法在学习端到端图像转换关系方面取得了惊人的成功，无需显式的分析模型。值得注意的是，通过深度学习的数据驱动逆算可以近似图像退化过程的伪逆函数以及SR解决方案的随机特性。然而，训练DLSR模型需要大量的配对低分辨率输入图像和高质量的ground truth（GT）SR图像，这在生物标本中由于快速动态或低荧光SNR而极其耗时，有时甚至不切实际。此外，DLSR方法的性能极大地依赖于训练数据的质量和数量。这些因素严重阻碍了DLSR方法在日常成像实验中的广泛应用，尽管其SR性能比基于分析模型的方法更具吸引力。

这里，我们提出了一种零样本去卷积深度神经网络（ZS-DeconvNet）框架，可以在无监督的方式下使用仅一个低分辨率和低SNR的单平面图像或体积图像栈来训练DLSR网络，从而实现零样本实现。与最先进的DLSR方法相比，ZS-DeconvNet可以适应多种生物成像环境，其中生物过程太动态，太敏感到光，无法获取ground-truth SR图像，或者图像获取过程受到未知和非理想因素的影响。我们表明，ZS-DeconvNet可以在仅使用一个低SNR输入图像和无需图像特定参数调优的情况下，以高保真度和可量化性提高分辨率超过1.5倍的衍射极限。我们证明了正确训练的ZS-DeconvNet可以在毫秒时间尺度上推断高分辨率图像，实现多个细胞器相互作用、细胞骨架和细胞器动力学的高速、长期、超分辨率2D/3D成像，以及在发育中的C. elegans 和小鼠胚胎中子细胞结构和动力学的成像。此外，为了使ZS-DeconvNet更容易被生物研究社区使用，我们建立了一个Fiji插件工具箱和一个ZS-DeconvNet方法的教程主页。

ZS-DeconvNet的概念基于光学成像前向模型的无监督逆问题求解器： 1 arg min θ y −fθy*PSF↓ 2 2 ，其中y 表示噪声低分辨率图像，PSF是点扩散函数，f θ 表示具有可训练参数θ 的深度神经网络， (  ⋅  )↓ 表示下采样操作。如果直接通过上述目标函数训练DNN，它将不必要地放大生物图像中的光子噪声，这将在低SNR条件下严重污染真实标本信息（补充Fig. [1a] ）。为了提高ZS-DeconvNet的噪声鲁棒性，同时保持其无监督特性，我们采用了一种图像重污染方案，从原始图像生成两个噪声独立的重污染图像，然后将其用作网络训练的输入和GT（方法）。我们在补充Note [1] 中理论证明了普通sCMOS图像中混合泊松-高斯噪声模型的高斯近似有效性，并证明了将重污染方案纳入无监督逆问题求解器的收敛性。此外，我们引入了Hessian正则化项，它已被证明对减轻显微镜图像中的重构artifact有用（补充Fig. [1b–e] ）。总的来说，ZS-DeconvNet的总目标函数可以公式化为： 2 arg min θ 1 N ∑ i = 1 N L yi − D−1 g ,fθ  y i  +Dg*PSF↓ + λ R H e s s i a n fθyi+Dg ，其中N 是要处理的图像总数，D  是根据信号和噪声水平计算的可逆噪声控制矩阵，g 是从标准正态分布中采样的随机噪声图。我们将目标函数的第一部分称为退化项，负责推断保真度，将第二部分称为正则化项，合理化SR输出。

定义了目标函数后，我们采用了一种双阶段DNN架构，由两个顺序连接的U-Net组成，作为ZS-DeconvNet的简单但有效的骨架（Fig. [1a, b] 和补充Fig. [2a] ）。第一阶段作为去噪器，根据去噪损失生成无噪图像（方法），第二阶段根据上述无监督去卷积损失提高图像分辨率。我们经验性地发现，双阶段架构和物理模型调节的损失函数稳定了训练过程，并为整个网络模型赋予了可解释性。

为了表征和评估ZS-DeconvNet，我们首先模拟了被高斯-泊松噪声污染的点状和管状结构的显微镜图像，信号水平从5到25个平均光子计数不等，这使我们能够系统地测试不同成像条件下重腐蚀超参数设置如何影响最终输出（补充说明2）。我们发现，最佳超参数在理论上与图像内容和信号水平无关（补充图3-5），因此可以将ZS-DeconvNet鲁棒地应用于各种生物样本和成像配置（补充说明4）。接下来，我们比较了使用单个噪声图像重腐蚀数据训练的ZS-DeconvNet模型与使用分析性解卷积算法或使用多个模拟或独立采集的图像训练的模型的性能。为此，我们使用了我们自主构建的多模态结构照明显微镜（Multi-SIM）的全内反射荧光（TIRF）照明模式，获得了每个细胞内溶酶体（Lyso）和微管（MTs）结构的低信噪比和高信噪比的约20组衍射极限TIRF图像，其中低信噪比图像用于训练和测试，而高信噪比的对应图像作为参考（方法）。我们发现，ZS-DeconvNet图像的峰值信噪比（PSNR）和分辨率明显优于分析算法生成的图像，例如经典的Richardson-Lucy（RL）和最新开发的稀疏解卷积（图1c-e），并且一个良好训练的ZS-DeconvNet的吞吐量比稀疏解卷积算法高出100倍以上（图1f）。特别是，即使ZS-DeconvNet是使用单个输入图像的增强数据训练的，其输出图像的感知质量和量化指标也与使用大量数据训练的模型的图像相当（补充图6）。此外，我们验证了ZS-DeconvNet的分辨率改进、量化和泛化能力（补充图7-10），并将其与监督DFCAN模型（补充图11）在合成和实验数据上进行了比较。这些表征表明，ZS-DeconvNet能够生成高质量的DLSR图像，相对于衍射极限，分辨率改进了1.5倍，同时使用最少的训练数据，这有望升级各种显微镜系统的成像性能，并将其应用范围扩展到传统方法难以处理的广泛生物过程中。

细胞粘附和迁移在形态发生过程中至关重要，并且对许多疾病做出了贡献。高分辨率成像细胞粘附/迁移过程中的细胞骨架动力学对于阐明其潜在机制至关重要。然而，由于严重的光敏性，细胞粘附和迁移的整个过程通常以低帧率（即每帧几秒）和低光强记录。 在这些成像条件下，经典的Richardson-Lucy（RL）解卷积或基于时间连续性的自监督学习（方法）都无法恢复和锐化F-actin和肌动蛋白-II的复杂结构（图2a，补充图12和补充视频1）。相比之下，ZS-DeconvNet模型有效地提高了两色时间序列记录的信噪比和分辨率，该记录显示了在涂片上滴落共表达mEmerald-Lifeact和mCherry-myosin-IIA的COS-7细胞的扩散过程（图2b和补充视频2）。令人着迷的是，我们观察到在某些物质中，细胞会在扩散和粘附之前在接触位点周围爬行以探索邻域（图2c和补充视频3）。细胞爬行是在细胞后部肌动蛋白-II的极化积累之后发生的，导致了由后部肌动蛋白-II收缩驱动的细胞迁移与相反方向。另外，迁移方向可以迅速响应细胞内肌动蛋白-II的动态重新分布而改变（图2d）。这些结果表明，ZS-DeconvNet辅助成像可以在不干扰这种漫长而脆弱的过程的情况下忠实地记录细胞粘附和迁移的动力学。

扩散过程后，将共表达mEmerald-Lifeact和mCherry-myosin-IIA的COS-7细胞滴落在涂片上（图2b和补充视频2）。令人着迷的是，我们观察到在某些物质中，细胞会在扩散和粘附之前在接触位点周围爬行以探索邻域（图2c和补充视频3）。细胞爬行是在细胞后部肌动蛋白-II的极化积累之后发生的，导致了由后部肌动蛋白-II收缩驱动的细胞迁移与相反方向。另外，迁移方向可以迅速响应细胞内肌动蛋白-II的动态重新分布而改变（图2d）。这些结果表明，ZS-DeconvNet辅助成像可以在不干扰这种漫长而脆弱的过程的情况下忠实地记录细胞粘附和迁移的动力学。

内体系统包括多种类型的囊泡，这些囊泡以高度动态但又高度有序的方式发挥作用。虽然活细胞荧光成像已经显著改善了我们对内体系统的理解，但大多数研究都需要过表达感兴趣的蛋白质来记录其快速动力学，这通常会导致伪影形态或行为。使用ZS-DeconvNet，我们能够成像内源性表达EGFP-Rab11和mCherry-Lamp1的SUM-159细胞系，成像时间长达1500帧，分辨率约为150nm，两色成像帧率为3帧/秒（图2e和补充视频4），从而使我们能够在比以前成像时间窗口更长、空间时间尺度更细的条件下可视化和跟踪回收内体（REs）和溶酶体或晚期内体（LEs）的快速运动。如图2f-h所示，我们发现大多数REs（n=505条轨迹）经历了方向运动，总位移为6.7±5.4μm，速度为2.2±1.2μm/s（瞬时速度超过5.3μm/s），中间暂停很少，然后在特定位点停留13.5±10.3秒后与细胞膜融合。这种观察表明，REs可能被高效地运输到靠近细胞膜的区域，以便于随后的外吐作用。出乎意料的是，ZS-DeconvNet捕捉到了Rab11阳性REs的多个裂解事件，其中两个分离的REs顺序地经历了外吐作用（补充图13a），或者一个RE移动走了（补充图13b）。这种观察表明，高度专门化的Rab11阳性REs可能会在外吐作用之前经历进一步的货物排序。

相比之下，LEs的运动通常是断续的，以相对较慢的速度1.6±0.6μm/s（n=230条轨迹）进行（图2f、g、i）。虽然LEs的运输似乎效率低下，但LEs通常会在91.8秒的时间内持续存在，总位移长达23.6μm（平均值来自n=230条轨迹）（图2h）。有趣的是，我们注意到两个或多个LEs有时会以“亲吻-停留”的方式相互连接，并在一定距离上共同迁移，然后再分裂成单个LEs（图2i和补充图13c），这可能有助于LEs在没有足够的motor-protein-adaptors进行长距离运输的情况下进行方向运动。LEs的这些复杂动力学表明，其定位和移动是由多种因素精细调节的，例如MT-based motors和膜接触。

体积活细胞成像比2D观察提供了更多的生物信息；然而，它受到更严重的光毒性、光漂白和非焦点荧光污染的影响。为了扩展ZS-DeconvNet的体积超分辨率成像能力，我们将双阶段网络架构的骨干升级为3D RCAN，它已被证明适用于体积图像恢复（Fig. [3a, b] 和Supplementary Fig. [2b] ）。接下来，我们将之前提出的空间交错自监督学习方案与物理模型信息自监督逆问题求解器相结合，构建了3D ZS-DeconvNet。具有空间交错自监督方案的3D ZS-DeconvNet遵循更简单的数据增强过程（方法），同时实现了与重构策略相似的或更好的性能（Supplementary Fig. [14] ）,。

我们系统地评估了3D ZS-DeconvNet模型，使用了通过我们自建的格子光片结构照明显微镜（LLS-SIM）获得的三个不同生物样本的数据集，其中通过格子光片显微镜（LLSM）模式获得的衍射极限数据用于训练，而通过LLS-SIM模式获得的超分辨率对应数据作为参考（方法）。我们发现3D ZS-DeconvNet成功地重构了F-actin的精细丝、线粒体（Mito）外膜的空心结构和内质网（ER）的复杂网络，具有与在高信噪比条件下获得的LLS-SIM图像相似的高保真度和分辨率（Fig. [3c] ）。PSNR和分辨率的量化结果表明，3D ZS-DeconvNet模型在多种生物样本中比传统的基于分析模型的方法有了显著的改进（Fig. [3d] ）。我们证明，通过训练噪声图像堆栈本身，双阶段3D ZS-DeconvNet不仅生成了与最先进的自监督去噪技术相似的去噪结果（Supplementary Fig. [15] ），还提供了具有显著分辨率改进的超分辨率图像堆栈，改进了1.5倍以上的横向（Supplementary Fig. [16] ）和轴向（Supplementary Fig. [17] ）分辨率。此外，通过顺序整合自学习基于轴向分辨率增强方法，轴向分辨率可以进一步改进（Supplementary Fig. [17g–i] ）, ,。

体积观察细胞分裂在高时空分辨率下对于探索有丝分裂相关的生物机制至关重要，例如将细胞质中众多不同的细胞器分配到每个子细胞中的机制,。由于有丝分裂细胞的极端光敏性和脆弱性，之前的体积超分辨率成像依赖于低光LLS-SIM系统和基于监督学习的超分辨率重构 。然而，收集高质量的训练数据极其耗时，有时甚至不切实际，因为有丝分裂过程中细胞器的形态和分布通常会发生戏剧性的变化 。在这里，我们证明了自监督的3D ZS-DeconvNet模型可以被广泛应用于从噪声LLSM体积中超分辨率细化ER、Mito和染色体的细微亚细胞结构，而无需额外的训练数据，从而实现了在有丝分裂HeLa细胞中1000个时间点、每10秒间隔的快速和长期体积超分辨率观察（Fig. [3e] 和Supplementary Video [5] ）。此外，ZS-DeconvNet的自监督特性允许我们整合测试时适应学习策略，以充分利用每个噪声体积中的结构内容，从而获得最佳的3D超分辨率性能（方法）。相比之下，传统的先验依赖的去卷积算法和时间交错自监督学习方法都未能恢复样本的高频细节，因为低信噪比条件和相邻时间点之间的弱时间一致性（Fig. [3f] 和方法）。此外，根据3D ZS-DeconvNet提供的低侵入性，一组有丝分裂HeLa细胞被标记为H2B-mCherry和HeLa-mEmerald-SC35，在100×50×25 μm的大视野（FOV）中成像超过300个时间点，从而以高时空分辨率记录了整个核斑的解聚和重聚过程（Supplementary Fig. [18] 和Supplementary Video [6] ）。简而言之，3D ZS-DeconvNet允许生物学家轻松以低侵入性和更高的时空分辨率探索各种光敏生物过程，而无需任何额外的数据集或光学设置修改, ,。

ZS-DeconvNet依赖于噪声的随机性和光学显微镜的低通滤波特性，这些特性在各种类型的显微镜模式中都很常见。基于此，我们期望ZS-DeconvNet可以被广泛应用于所有显微镜，例如最常用的共焦显微镜和宽场（WF）显微镜。为了研究3D ZS-DeconvNet在共焦数据上的性能，我们使用自建的共焦显微镜获得了小鼠早期胚胎的四色体积图像，图像中微管、染色体、肌动蛋白和顶端域都被免疫标记（方法），这些结构在第一次细胞命运决定中起着关键作用，并且对于胚胎发育至关重要, ,。然后，我们在这个单个噪声体积上训练了3D ZS-DeconvNet模型，并使用训练好的模型处理原始数据。如Fig. [4a, b] 所示，3D ZS-DeconvNet显著提高了共焦数据体积的信噪比、对比度和分辨率，并解析了微管桥和肌动蛋白环的精细结构（Fig. [4c, d] 、Supplementary Fig. [19] 和Supplementary Video [7] ）。这些结果表明ZS-DeconvNet能够在大尺度上实现共焦显微镜的更高空间分辨率和更低的光子预算，例如小鼠早期胚胎，这对于研究细胞 polarity、细胞内运输和囊胚形成至关重要 。

我们接着使用Multi-SIM系统的3D WF模式成像了具有顶端连接、细胞膜和溶酶体标记的线虫胚胎（方法）。为了确保线虫胚胎的发育不受干扰，我们在30秒的间隔内以相对较低的光照激发获得了原始图像堆栈，共超过200个时间点。然而，在这种条件下，WF图像受到非焦点背景和噪声的严重污染（Fig. [4e, f] ）。即使在这种具有挑战性的情况下，3D ZS-DeconvNet图像也表现出显著的噪声和背景抑制，同时提高了亚细胞细节的空间分辨率（Fig. [4e, g] 和Supplementary Video [8] ），从而使我们能够研究胚胎发育的精细过程，例如皮层细胞融合（Fig. [4h] ），即使使用简单的WF显微镜 。

在各种超分辨率（SR）显微镜中，结构照明显微镜（SIM）通常被认为是超分辨率活细胞成像的平衡选择，因为它需要不到十张原始调制图像就可以提供两倍的空间分辨率提高,。然而，传统的SIM有两个关键限制：首先，进一步提高分辨率需要大量原始数据，例如，非线性SIM需要至少25张原始图像才能获得低于80纳米的分辨率；第二，SIM图像的后处理通常需要原始图像具有高信噪比（SNR）以消除噪声诱导的重建伪影，从而阻碍快速、低光、长时间的活细胞成像,。最近的研究探索了使用监督学习方法来降噪SIM图像或直接从原始图像重建SR SIM图像以实现低光SIM重建；然而，这些方法需要大量的训练数据，并且不能进一步提高分辨率。在ZS-DeconvNet的出色降噪和SR能力的基础上，我们将零样本学习方案与传统的SIM重建算法相结合，并从理论上证明了ZS-DeconvNet适用于处理SR-SIM图像（补充说明 [1] ）。我们设计了ZS-DeconvNet增强SIM（ZS-DeconvNet-SIM）模型，以无监督的方式同时降噪和增强SR SIM图像（图 [5a] ，补充图 [20a] ，和方法）。借助ZS-DeconvNet-SIM提供的SNR和分辨率的显著提高（补充图 [21] ， [22] ），SUM-159细胞中的夹层结构和COS-7细胞中的密集交错的细胞骨架，在WF和传统SIM图像中无法区分，变得清晰可见（图 [5b, c] ）。此外，我们证明了ZS-DeconvNet-SIM可以应用于3D-SIM模式，以同时降噪和增强3D-SIM图像在横向和轴向上的分辨率（方法，补充图 [23] ）, ,。

此外，我们将3D ZS-DeconvNet与激光光片结构照明显微镜（LLS-SIM）相结合，开发了3D ZS-DeconvNet-SIM模式（补充图 [20b] ）。通过将传统LLS-SIM的各向异性点扩散函数（PSF）纳入训练过程，3D ZS-DeconvNet LLS-SIM不仅显著提高了三个维度的对比度和分辨率，而且提供了约150纳米的等向横向分辨率（图 [5d, e] ，和补充图 [22] ）。这些成功应用ZS-DeconvNet到多模态SIM系统的结果，证明了其进一步扩展现有SR技术的时空分辨率带宽的能力 。

活细胞成像的最终目标是以最小的侵入性收集生物过程的最多时空信息。然而，荧光显微镜中的成像速度、持续时间、分辨率和信噪比之间的相互限制，导致了时空带宽限制，这限制了所有这些方面的协同改进。例如，为了获得更高的空间分辨率，传统的SR技术必须依赖重复采集或额外的激发，这加剧了光毒性和光漂白，阻碍了快速、长时间的生物过程观察。为了解决显微镜中的时空带宽限制，我们对光学成像模型和SIM重建中的噪声传播进行了深入分析（补充说明[1]），证明了在普通和SIM场景中，基于PSF卷积线性的重构-集成自监督损失函数的收敛性，并提出了通用的ZS-DeconvNet框架，该框架可以与各种光学荧光显微镜相结合，瞬间提高图像信噪比和分辨率，而不损害其他成像特性。我们强调ZS-DeconvNet对图像重构过程中的超参数具有鲁棒性（补充图[24]），并且ZS-DeconvNet可以仅使用一张或一组原始图像进行良好的训练（补充图[6]，[16]），而无需使用结构稀疏性和时间连续性的假设, ,。在模拟和实验数据上的定量和定性评估表明，我们的方法显著提高了图像质量和分辨率，超过1.5倍，具有高保真度和可量化性，即使在低光条件下，也可以实现快速、长时间的超分辨率观察多个亚细胞动态过程。

提出的ZS-DeconvNet方法适用于各种类型的成像模态，从扫描基显微镜（例如，共焦显微镜和二光子显微镜，补充图[25]），到宽场检测基显微镜（例如，TIRF，3D WF显微镜，LLSM和多模态SIM）。我们通过六种不同的显微镜设置，对十多种不同的固定或活体标本进行了成像，包括单细胞中多个细胞器的平面和体积成像，细胞分裂过程中亚细胞动态和相互作用的观察，以及早期小鼠胚胎和C. elegans 胚胎的多色3D成像。为了使我们的方法更容易使用和方便，我们将ZS-DeconvNet和3D ZS-DeconvNet集成到一个用户友好的Fiji插件中（补充图[26]，[27]，补充说明[3]，[4]，和补充视频[9]），允许用户即使没有深度学习经验，也可以轻松训练自己的ZS-DeconvNet模型，并在Fiji中以鼠标点击的方式增强显微镜图像。ZS-DeconvNet的功能和便捷性表明其在升级现有光学显微镜性能方面具有巨大的潜力。

尽管ZS-DeconvNet具有普遍的鲁棒性和适用性，但用户应该仔细考虑其潜在的虚假现象和局限性。首先，ZS-DeconvNet可能将极低的荧光信号误认为是光子噪声，从而在输出图像中削弱它们（补充图[28a]）。这种错误可以通过图像质量检查工具（如SQUIRREL） 在一定程度上被检测到。第二，如果一个训练良好的ZS-DeconvNet模型被应用于处理与训练数据明显不同的图像（例如，使用不同的成像模态），可能会出现明显的性能下降和更高的虚假现象风险（补充图[28b]）。第三，ZS-DeconvNet模型应该使用与数据集匹配的PSF进行训练，否则使用不匹配的PSF进行训练可能会导致分辨率提高不明显或出现环形伪影（补充图[28c]）。最后，我们不期望无监督的ZS-DeconvNet能够生成与使用高质量数据集训练的监督DLSR模型相当的SR图像（补充图[11]）。然而，在无法获得此类数据集的成像实验中，ZS-DeconvNet将是一个强大且方便的工具，用于解析生物细节以达到可能的最细程度。













值得注意的是，自从ZS-DeconvNet的理论基础是模型无关的，U-Net和RCAN不仅是唯一适用的骨干模型，而且也是广泛采用的高效模型。装备ZS-DeconvNet以其他最先进的网络架构，例如DFCAN和RLN，可能会进一步提高其去噪和SR能力 。

用于训练2D ZS-DeconvNet模型的图像对 (ŷ , y  ̃ )是按照修改的策略从原始的重腐蚀到重腐蚀的策略生成的，假设混合了泊松-高斯噪声分布，其中三个超参数β 1 ,β 2 ,α  需要预先确定。从单个噪声图像y 的重腐蚀过程可以用矩阵形式表示为： 9 y ̂ = y + D g 10 ỹ= y − D − 1 g  其中D = α I  是一个可逆矩阵，定义为一个通过α  因子放大的单位矩阵，它控制添加噪声的总幅度，而g  是一个从零均值的高斯分布中采样的随机噪声图： 11 g ~ N 0 , σ2 I 12 σ 2 = β 1 H y − b + β 2 其中β 1 是泊松噪声的方差因子，β 2 是高斯噪声的方差因子，b  是背景，近似地被认为是一个与相机相关的固定值，通过减去它，我们从样本中提取了荧光信号。H(⋅)是一个线性低通滤波器，用于预先平滑图像并降低噪声，我们在实验中采用了一个5像素大小的平均滤波器 。

如Supplementary Note [1] 所证明的，β 1 和α  的理论最优值是1，而β 2 依赖于相机，可以从图像本身的无样本区域估计或按照标准协议预先校准 。在模拟数据上的评估表明，无论测试图像的结构和信噪比如何，在这些超参数的理论最优值处都能获得最佳的去噪和SR性能（Supplementary Figs. [3] , [4] ）。

3D ZS-DeconvNet的训练方案将空间交错的自监督学习方案与自监督逆问题求解器相结合。在训练过程中，每个噪声图像堆栈被分成奇数切片和偶数切片，然后在随机旋转、裁剪和翻转的增强后，分别用作输入和目标。为了修正奇数切片和偶数切片之间的期望差距，我们在去噪损失和去卷积损失中引入了间隙修正正则化（GAR）项，它是用去噪堆栈（在Fig. [3a] 中用红色框标记）、噪声偶数切片和网络输出计算的（详见Supplementary Note [1b] ） 。

对于2D-SIM和3D-SIM的ZS-DeconvNet-SIM实现，每组原始SIM图像首先通过公式9和10增强成两组重腐蚀的原始图像，然后通过传统的SIM重构算法重构成一对SR SIM图像。生成的SIM图像对然后用于与训练ZS-DeconvNet模型类似的自监督训练方式。对于在LLS-SIM（Fig. [5d, e] ）上应用的3D ZS-DeconvNet-SIM，原始图像不是raw图像，而是后重构的体积SIM数据，轴向采样成两个分别包含奇数切片和偶数切片的SIM堆栈，然后用于3D ZS-DeconvNet模型的后续训练过程，损失函数如公式6-8所述。ZS-DeconvNet-SIM的示意性工作流程如Fig. [5a] 和Supplementary Fig. [20] 所示 。

在ZS-DeconvNet的训练过程中，我们使用实验获取或模拟的PSF（使用Fiji插件PSF Generator，获得自EPFL），这些PSF与成像配置相对应。我们为每个生物结构和发射波长训练独立的ZS-DeconvNet模型，以获得最佳性能。

在这项工作中，ZS-DeconvNet模型是在一台配备Intel Core i7-11700处理器和NVIDIA RTX 3090图形处理卡的PC上训练的，使用TensorFlow 2.5.0和python 3.9.7。在训练之前，成对的输入/GT图像首先通过随机裁剪、水平/垂直翻转和旋转变换增强成多个patch对，以进一步丰富训练数据集，最终生成~20,000对2D patch（128×128像素）或~10,000对3D patch（64×64×13体素）。训练通常使用Adam优化器和初始学习率0.5×10^-4进行，学习率每10,000次迭代衰减0.5倍。2D图像的训练批大小为4，3D栈的训练批大小为3。整个训练过程通常需要50,000次迭代用于2D图像和10,000次迭代用于3D栈。训练50,000次迭代的2D模型和10,000次迭代的3D模型所需的时间分别约为1小时和2小时。与大多数深度学习方法一样，ZS-DeconvNet的训练通常是在大多数活细胞成像情况下是一次性的过程，其中用户使用所有帧训练ZS-DeconvNet模型，然后使用训练好的模型以高处理速度处理同一生物样本的所有数据。为了消除由去卷积引起的边缘artifact，我们通常在3D栈的顶部和底部添加2个空白切片，并在训练和推理过程中为每个xy切片添加8像素的边缘（补充图30a）。特别是，当处理细胞有丝分裂的时间序列数据（图3e，f）时，ZS-DeconvNet的无监督性质使我们能够采用测试时适应学习策略，即首先使用整个过程的数据训练一个通用模型，然后使用少量训练步骤（通常为50次迭代，耗时约1分钟）对每个时间点的预训练模型进行微调，以充分利用原始数据的结构信息并获得最佳的超分辨率性能。需要注意的是，测试时适应不是必需的，但是一种可选的技术，用于在生物样本在观察窗口期间发生巨大形态变化的情况下改善ZS-DeconvNet的性能，例如有丝分裂期间的染色体（补充图31） 。

对于使用宽场检测的成像模式，例如LLSM，相机像素灵敏度非均匀性引起的固定模式噪声（FPN）不能通过噪声2噪声方案去除 。在我们的ZS-DeconvNet实现中，FPN将在去卷积阶段被增强，特别是在极低SNR的成像条件下变得不可忽略。对于sCMOS传感器，它们是荧光显微镜中最常用的，固定模式通常表现为由列放大器引起的水平或垂直条纹。为此，我们简单地在傅里叶域中应用了一个apodization掩膜，以抑制条纹artifact，同时保留样本的其他频率成分（补充图30b）。需要注意的是，固定模式噪声也可以通过对获取的原始图像进行预校准基本上去除，方法是遵循成熟的程序, ,。

本工作中比较的其他计算超分辨率方法，即稀疏去卷积、DeepCAD基于去卷积和SRRF，是按照原始论文的指示实现的。特别是，我们尽量选择稀疏去卷积的最佳超参数，以获得重构图像中artifact最少和分辨率最高。DeepCAD基于去卷积（图2a和图3f）是通过将时间采样方案集成到我们的ZS-DeconvNet框架中实现的，即使用从时间序列数据中采样的图像训练我们的双阶段网络模型，确保与比较的方法具有相同的模型大小和计算成本 。



线性变换适用于所有方法，以便进行公平的比较；（3）计算归一化的GT图像x 和线性变换后的图像I trans 。

对于3D ZS-DeconvNet（Fig. [3d] ）的PSNR评估，我们直接利用LLS-SIM图像作为参考，因为LLS-SIM和我们的3D ZS-DeconvNet都提供了1.5倍的分辨率改进。整个计算过程与2D情况类似，除了SR栈没有进行卷积，PSNR仅在特征区域内计算，阈值为0.02，以避免获得异常高的PSNR值。

为了提供更好的对比度和可视化，我们对RL解卷积、稀疏解卷积和ZS-DeconvNet生成的解卷积图像进行了百分位归一化，公式如下： 15 Norm p Y , plow , phigh = Y − percentile Y,plowpercentile Y,phigh− percentile Y,plow ,  ，其中percentile（Y ，p ）输出图像Y 中排名p %的强度值。p l o w 和p h i g h 通常分别设置为3和100，在我们的图像和视频中。

Cos7、HeLa、293T细胞及其稳定细胞株在DMEM（Gibco，cat. no. 11965092）中培养，补充10%胎牛血清（Gibco，cat. no. 10099141 C）和1×青霉素-链霉素（Thermo Fisher，15140122），在37°C的Thermo Scientific™ Heracell™ 150i CO2 孵育器中。SUM159细胞在DMEM/F12K培养基中补充5%胎牛血清（FBS）和1%青霉素-链霉素溶液中培养。

对于活细胞成像，35mm盖玻片预先涂覆50 μg/ml的胶原蛋白和1×10个细胞。对于暂时转染，细胞使用Lipofectamine 3000（Invitrogen，cat. no. L3000150）按照制造商的协议在接种后12小时进行转染。细胞在转染后12小时进行成像。如有指示，转染Halo Tag质粒的细胞用10 nM JF549配体按照已发表的协议进行标记。细胞用新鲜培养基洗去未结合的配体，并立即进行成像。用于暂时转染的质粒包括Lifeact-mEmerald、Clathrin-mEmerald、3×mEmerald-Ensconsin、Lamp1-Halo、2×mEmerald-Tomm20、Myosin2-Halo、KDEL-mCherry和Halo-Calnexin。

对于病毒包装，1 μg 病毒转移载体 DNA 与 0.5 μg psPAX2 包装和 0.5 μg pMD2.G 外壳质粒 DNA 一起转染到 90% 凝集的 HEK293T 细胞中，使用 Lipofectamine 3000 按照制造商的协议进行。两天后，收集并用 0.22-μm 滤器（Millipore）过滤上清液。为了构建稳定细胞，HeLa 和 Cos7 细胞被感染以编码内质网标记物 Calnexin-mEmerald 和 F-actin 标记物 Lifeact-mEmerald 的病毒 。48 小时后，细胞被流式细胞仪（FACSAria III，BD Biosciences）富集，然后每个孔中放置一个细胞，放入 96 孔板中。单克隆细胞用于我们的实验。具体来说，COS7 中的 Lifeact-mEmerald 用于 Figs. [3] 和 [5] ；HeLa 细胞中使用的 Calnexin-mEmerald、Mito-dsRed 和 Halo-H2B 用于 Fig. [3] ；HeLa-mEmerald-SC35 中的 H2B-mCherry 用于补充 Fig. [18] 。

SUM159 细胞被顺序基因编辑以将 EGFP 融合到 Rab11A 的 N-端，然后将 Halo 融合到 Lamp1 的 C-端，使用 CRISPR/Cas9 方法,。单导向 RNA（sgRNA）靶序列为 RAB11A 的 5'-TCGCTCCTCGGCCGCGCAAT-3' 和 LAMP1 的 5'-CTATCTAGCCTGGTGCACGC-3'。SUM159 细胞被转染以 EGFP-Rab11A donnee 质粒、编码 spCas9 的质粒和含有 sgRNA 靶序列的自由 PCR 产物，使用 Lipofectamin 3000（Invitrogen）按照制造商的说明进行。表达 EGFP 的细胞被富集使用流式细胞仪（FACS）（FACSAria II，BD Biosciences），然后进行单细胞排序到 96 孔板中。单克隆细胞中成功融合 EGFP 的细胞被 PCR 筛选使用 GoTaq 聚合酶（Promega）识别。表达 EGFP-Rab11A +/+ 的 SUM159 单克隆细胞被进行第二轮基因编辑以将 Lamp1-Halo 融合到基因组中，如上所述。转染的细胞被 10 nM Janelia Fluor 646 HaloTag Ligands（Promega）染色 15 分钟。为了洗去未结合的染料，样品被用新鲜介质冲洗，然后被 FACS 富集。单克隆 SUM159 细胞同时表达 EGFP-Rab11A +/+ 和 Lamp1-Halo +/+ 被 PCR 和 Western blot 分析确认。

SUM159 细胞被基因编辑以将 EGFP 融合到轻链 A（clathrin-EGFP）的 C-端，使用 TALEN 基础方法 。表达 clathrin-EGFP 的细胞被两次顺序 bulk 排序富集。

HeLa 细胞系被基因编辑以将 mEmerald 融合到人类基因组 SC35 的 C-端，使用 CRISPR-Cas9 基因编辑系统。sgRNA 靶序列为 5'-CGAGCAGCACTCCTAATGAT-3'，并被连接到 pX330A-1×2（Addgene，58766）中。得到的质粒被命名为 pX330-SC35-gRNA。为了构建 donnee 质粒 p-SC35-doner，mEmerald 被 flank 以约 1800bp 的同源臂，同源臂与人类基因组 SC35 位点的停止密码子互补，被连接到 pEASY-blunt（Transgene，CB101）中。2 × 10^5 HeLa 细胞在 6 cm 容器中被转染以 1.2 μg 的 pX330-SC35-gRNA 和 0.4 μg 的 p-SC35-doner。48 小时后，mEmerald 阳性细胞被 FACS（FACSAria III，BD Biosciences）排序。一个星期后，H2B-mCherry 病毒被感染排序的细胞，然后单细胞被种植到 96 孔板中。两个星期后，不同单细胞克隆的基因组 DNA 被提取并被 PCR 和 Western blot 验证。同源 SC35 knock-in 细胞被选用进行研究。成功的 SC35 knock-in 被 PCR 和 Western blot 分析验证 。

C. elegans 菌株在 20 °C 的 nematode 生长介质（NGM）板上培养，板上撒有 OP50，按照标准协议 进行。TV52712[wyEx51119[dlg-1p::GFP::PLCdPH] ；jcIs1[ajm-1::GFP +UNC-29(+)+rol-6(su1006)] ；qxIs257 [ced-1p::nuc-1::mCherry + unc-76(+)]] 被用在本研究中。质粒dlg-1p::GFP::PLCdPH 被按照 Clontech In-Fusion PCR 克隆系统构建，并被微注射到jcIs1;qxIs257 中。外显子数组wyEx51119 标记了表皮细胞膜。jcIs1 标记了C. elegans 的顶端连接域。qxIs257 标记了表皮细胞中的溶酶体 。

大约50个L4阶段的转基因蠕虫被放在NGM平板上，新鲜的OP50被添加在48至60小时之前。转基因卵在解剖型荧光显微镜（Olympus MVX10）下被收集，并安装在3%的琼脂糖垫上。利马豆到2倍体阶段的胚胎随后使用我们的Multi-SIM系统的3D WF模式成像。

本研究中使用的小鼠属于C57BL/6 J背景。所有动物实验均获得了中国科学院生物物理研究所动物护理和使用委员会（IACUC）的批准。超排卵的5-6周龄雌性小鼠通过腹腔注射5国际单位（IU）的妊娠马血清促性腺激素（PMSG；LEE BIOSOLUTIONS）和5 IU的人绒毛膜促性腺激素（hCG；Millipore），48小时后与雄性小鼠交配。受精卵在E0.5时在M2培养基（Millipore）中回收，并在CO2孵育器（Thermo Scientific）中以37°C和5% CO2的条件下培养在KSOM培养基（Millipore）中，直到晚期8细胞阶段。

对于免疫荧光，胚胎被固定在4%的多聚甲醛中，PBS中，30分钟，在室温（RT）下，并洗涤了三次PBS。胚胎随后被渗透在0.5%的TritonX-100（Sigma）中，PBS中，20分钟，在室温（RT）下，洗涤了三次PBS，封闭在1%的牛血清白蛋白中，PBS中，1小时，在室温（RT）下，并孵育过夜在4°C下，使用抗pERM抗体（Abcam，ab76247），抗α-管蛋白-FITC（Sigma，F2168-.2 ML）和菲罗定-罗丹明（Molecular Probes，R415）。然后，胚胎被洗涤三次PBS，孵育1小时在室温（RT）下，使用二级抗体（Life technologies），染色15分钟在室温（RT）下，使用Hoescht 33342（Thermo），洗涤三次PBS，并使用自制的共焦显微镜成像。

Fig. [4f, g] 中显示的溶酶体的轴向色彩编码图像是使用Fiji生成的。Fig. [3e, f] 中显示的有丝分裂细胞和小鼠胚胎的3D渲染图像是使用商业软件Amira生成的。

Fig. [2] a–i， [3] f， [4a–h] 和 [5b–e] 中的实验均独立重复进行了至少3次标本，即细胞或胚胎，都获得了类似的结果。

有关研究设计的进一步信息，请参阅本文链接的 [Nature Portfolio Reporting Summary] 。

Fig. 1: a ZS-DeconvNet的双阶段架构及其训练阶段的示意图。 b ZS-DeconvNet的推理阶段的示意图。 c 通过RL去卷积（第二列）、稀疏去卷积（第三列）和ZS-DeconvNet（第四列）重构的Lyso和MTs的代表性SR图像。 为参考，显示了清晰的WF图像。 d RL去卷积、稀疏去卷积和ZS-DeconvNet在PSNR和分辨率方面的统计比较（ n = 100个感兴趣区域）。 e 清晰的WF图像和通过RL去卷积、稀疏去卷积和ZS-DeconvNet处理的图像的全宽半高（FWHM）比较（ n = 30个微管）。 为参考，灰色虚线标记了理论衍射极限。 f GPU-based稀疏去卷积和ZS-DeconvNet之间的测试时间比较（平均25个测试图像，1024 × 1024像素）。 中心线，中位数；限制，75%和25%；须状线，最大数据点和75百分位数之和的1.5倍，以及最小数据点和25百分位数之差的1.5倍；异常值，数据点大于上须状线或小于下须状线。 源数据作为源数据文件提供。 标尺，1.5 μm（ a ），5 μm（ c ），2 μm（ c 中的放大区域）。

Fig. 2: a ZS-DeconvNet重构的COS-7细胞中F-actin骨架和肌动蛋白-II的代表性SR图像，该细胞共表达mEmerald-lifeact和mCherry-myosin-IIA。 显示了原始噪声TIRF图像和通过RL去卷积、DeepCAD-based去卷积和ZS-DeconvNet处理的图像的比较。 b 通过ZS-DeconvNet增强的两色时间序列SR图像，显示了F-actin（青色）和肌动蛋白-II（黄色）在整个扩散过程中的协调动态，扩散过程发生在将COS-7细胞放在盖玻片上之后（补充视频[2] ）。 c ， d 通过ZS-DeconvNet增强的两色时间序列SR图像，显示了F-actin和肌动蛋白-II在爬行的COS-7细胞中的动态，肌动蛋白-II偏向于集中在细胞的后部（ d 中用黄色虚线标记），与爬行方向相反（ d 中用白色箭头标记）（补充视频[3] ）。 e 通过ZS-DeconvNet生成的回收内体（REs，绿色）和晚期内体（LEs，洋红色）的代表性SR图像，在基因编辑的SUM-159细胞中内源性表达EGFP-Rab11和mCherry-Lamp1（补充视频[4] ）。 f RE（上）和LE（下）运动的典型轨迹，显示了RE的快速定向运动和LE的双向运动。 g Lyso/LEs和REs之间的速度、位移和旅行时间的比较，以及REs在与质膜融合之前在其外排_sites附近的驻留时间的量化（ n = 505条RE轨迹和 n = 230条LE轨迹）。 为更好地展示分布，未显示超过150秒的运输时间或60 μm的位移的少数数据点。 中心线，中位数；限制，75%和25%。 使用无配对Mann-Whitney测试确定统计显著性（ p =1.38 ×10−7，5.65 ×10−35，和6.26 ×10−40，分别用于移动速度、运输时间和位移的测试）。 **** p < 0.0001。 源数据作为源数据文件提供。 h 时间序列图像显示了RE的定向运动和随后的与质膜融合。 i 时间序列图像显示了三个LEs相互连接并在一定距离上共同移动，然后分裂成单个LEs。 标尺，5 μm（ a ， c ， d ），2 μm（ a 中的放大区域），8 μm（ b ），3 μm（ e ），0.5 μm（ e 中的放大区域），1 μm（ g ， f ， i ）。

Fig. 3: a 3D ZS-DeconvNet 的网络架构及其训练阶段的示意图。 b 3D ZS-DeconvNet 的推理阶段的示意图。 c 代表性的最大强度投影（MIP）SR 图像，展示了 F-actin、Mito 外膜和 ER 经过稀疏去卷积（第二列）、3D ZS-DeconvNet（第三列）和 LLS-SIM（第四列）重构的结果。原始图像前处理中最高 1% 像素的平均 sCMOS 计数在右上角标注。 d 比较了 RL 去卷积、稀疏去卷积和 ZS-DeconvNet 在不同标本（ n = 40 个感兴趣区域）上的 PSNR 和分辨率。分辨率通过 F-actin 图像栈的傅里叶环相关分析 测量。中位数，中位数；限制，75% 和 25%；须状线，最大值和最小值。源数据作为源数据文件提供。 e 通过 3D ZS-DeconvNet 重构的 ER、H2B 和 Mito 的时间序列三色 3D 渲染图像，展示了它们在有丝分裂过程中的形态和分布变化以及相互作用动力学（补充视频[5] ）。 f 通过传统 LLSM（第一列）、稀疏去卷积（第二列）、DeepCAD 基于去卷积（第三列）（方法）和 3D ZS-DeconvNet（第四列）获得的代表性三色图像。比较是在时间序列数据（ e ）的两个典型时间点上进行的。比例尺，5 μm（ c ， e ， f ），1.5 μm（ c 的放大区域），2 μm（ f 的放大区域）。

Fig. 4: a ， b 代表性的共焦（左上）、稀疏去卷积（左下）和 3D ZS-DeconvNet 增强（右）的图像，展示了早期小鼠胚胎的微管（青色）、染色体（橙色）、肌动蛋白环（洋红色）和顶端域（绿色）的免疫荧光染色。 c ， d 微管桥（c）和肌动蛋白环（d）的放大区域，分别通过共焦显微镜、稀疏去卷积和 3D ZS-DeconvNet 获得。这些区域在（ a ）和（ b ）中用白色虚线框标注。 e 代表性的广场场（中心区域）和 3D ZS-DeconvNet 增强（周围区域）的图像，展示了带有顶端连接、细胞膜（青色）和溶酶体（红色）标记的 C. elegans 胚胎。 f ， g ( e ) 中心区域的溶酶体通道，根据距基材的距离进行颜色编码。广场场（ f ）和 3D ZS-DeconvNet 处理的图像（ g ）均用于比较。 h 时间序列 3D ZS-DeconvNet 增强图像，展示了 C. elegans 胚胎发育过程中的皮质细胞融合过程（红色箭头）。比例尺，5 μm（ a ， b ， e ），2 μm（ c ， d ），3 μm（ g ， h ），1 μm（ g 的放大区域）。Gamma 值， C. elegans 胚胎的细胞膜和溶酶体为 0.7。

Fig. 5: a ZS-DeconvNet 用于 SIM 的训练过程示意图。 b SUM-159 细胞中 CCP 的信噪比和分辨率改进过程，分别从原始 SIM 图像（左）、传统 SIM 图像（右）和 ZS-DeconvNet 增强的 SIM 图像（中）可见。 c COS-7 细胞中微管的信噪比和分辨率改进过程，分别从原始 SIM 图像（左）、传统 SIM 图像（右）和 ZS-DeconvNet 增强的 SIM 图像（中）可见。 d 代表性的最大强度投影（MIP）图像，展示了 HeLa 细胞中 F-actin 经过 LLSM、LLS-SIM 和 3D ZS-DeconvNet 增强的 LLS-SIM 获得的结果，跨三个维度。 e ，代表性的最大强度投影（MIP）图像，展示了 293 T 细胞中用 TOMM20 标记的线粒体外膜，分别通过 LLSM、LLS-SIM 和 3D ZS-DeconvNet 增强的 LLS-SIM 获得的结果，跨三个维度。比例尺，1 μm（ a ），2 μm（ b ， c ），0.5 μm（ b 和 c 的放大区域），3 μm（ d ， e ）。

